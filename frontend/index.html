<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            background-color: #4CAF50;
        }
        .navbar-brand, .navbar-nav .nav-link {
            color: white !important;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }
        .btn-primary {
            background-color: #4CAF50;
            border-color: #4CAF50;
        }
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        .btn-primary.theme-green:hover {
            background-color: #229954;
            border-color: #229954;
        }
        .btn-primary.theme-pink:hover {
            background-color: #FF7788;
            border-color: #FF7788;
        }
        .table-hover tbody tr:hover {
            background-color: #f1f1f1;
        }
        .upload-form {
            margin: 20px 0;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .alert {
            margin-top: 20px;
        }
        
        /* 页面标题样式 */
        .page-title {
            color: #3498db;
            font-weight: bold;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5rem;
        }
        
        /* 信息卡片样式 */
        .info-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-align: center;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .info-card i {
            font-size: 2rem;
            color: #3498db;
            margin-bottom: 1rem;
        }
        
        .info-card h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .info-card p {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
            margin: 0;
        }
        
        /* 响应式设计 - 移动端 */
        @media (max-width: 768px) {
            .navbar-nav {
                flex-direction: column;
            }
            
            .navbar-nav .nav-link {
                margin-right: 0;
                margin-bottom: 0.5rem;
                padding: 0.75rem 1rem;
            }
            
            .info-card {
                margin-bottom: 1rem;
                padding: 1.25rem;
            }
            
            .page-title {
                font-size: 1.5rem;
                text-align: center;
            }
            
            .info-card i {
                font-size: 1.5rem;
            }
            
            .info-card h3 {
                font-size: 1.1rem;
            }
            
            .info-card p {
                font-size: 1.5rem;
            }
            
            .upload-form {
                margin: 10px 0;
                padding: 15px;
            }
            
            .card {
                margin-bottom: 1rem;
            }
            
            /* 表格响应式处理 */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            /* Tab页面响应式处理 */
            .nav-tabs {
                flex-wrap: wrap;
                margin-bottom: 1rem;
            }
            
            .nav-tabs .nav-item {
                margin-bottom: 0.5rem;
            }
            
            .nav-tabs .nav-link {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
            
            /* 营养分析页面响应式处理 */
            #nutrition-analysis .row {
                flex-direction: column;
            }
            
            #nutrition-analysis .col-md-6 {
                width: 100%;
                margin-bottom: 1rem;
            }
            
            /* 菜品分类页面响应式处理 */
            #dish-category .card-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            #dish-category .card-header button {
                margin-top: 0.5rem;
                width: 100%;
            }
            
            /* 表单元素响应式处理 */
            .form-control {
                margin-bottom: 0.75rem;
            }
            
            .btn {
                margin-bottom: 0.5rem;
                width: 100%;
            }
            
            /* 按钮组响应式处理 */
            .btn-group {
                flex-direction: column;
                width: 100%;
            }
            
            .btn-group .btn {
                width: 100%;
                margin-right: 0 !important;
                margin-bottom: 0.5rem;
            }
            
            /* 周选择器响应式处理 */
            #weekSelector {
                width: 100%;
                margin-bottom: 1rem;
            }
            
            /* 上传按钮响应式处理 */
            #basicMenuFile {
                width: 100%;
            }
            
            /* 卡片响应式调整 */
            .card {
                margin-bottom: 1.5rem;
            }
            
            .card-header {
                padding: 1rem;
            }
            
            .card-body {
                padding: 1rem;
            }
            
            /* 按钮间距调整 */
            .btn + .btn {
                margin-left: 0;
                margin-top: 0.5rem;
            }
            
            /* 表单元素调整 */
            .form-label {
                margin-bottom: 0.5rem;
                font-weight: 600;
            }
            
            /* 周选择器和按钮容器响应式调整 */
            .d-flex.flex-wrap.justify-content-between.align-items-center {
                flex-direction: column;
                align-items: stretch !important;
            }
            
            .d-flex.align-items-end.gap-2.flex-wrap {
                flex-direction: column;
                align-items: stretch !important;
                width: 100%;
            }
            
            /* 营养分析图表响应式调整 */
            #nutritionChart,
            #calorieChart {
                max-height: 250px;
            }
            
            /* 标签页调整 */
            #menuTabs {
                margin-bottom: 1rem;
            }
            
            /* 表格调整 */
            table {
                font-size: 0.875rem;
            }
            
            th,
            td {
                padding: 0.75rem;
            }

            .form-control {
                margin-bottom: 0.75rem;
            }
            
            /* 模态框调整 */
            .modal-dialog {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }
            
            /* 卡片布局调整 */
            .card-body {
                padding: 1rem;
            }
            
            /* 菜单列表调整 */
            .menu-list-container,
            .selected-dishes-container,
            .all-dishes-container {
                max-height: 250px;
            }
        }
        
        /* 平板设备响应式设计 */
        @media (min-width: 769px) and (max-width: 1024px) {
            .info-card {
                padding: 1.2rem;
            }
            
            .info-card i {
                font-size: 1.8rem;
            }
            
            .upload-form {
                margin: 15px 0;
                padding: 18px;
            }
            
            /* 表格响应式处理 */
            .table-responsive {
                overflow-x: auto;
            }
            
            /* 菜单列表调整 */
            .menu-list-container,
            .selected-dishes-container,
            .all-dishes-container {
                max-height: 300px;
            }
        }
        
        /* 桌面设备优化 */
        @media (min-width: 1025px) {
            .container {
                max-width: 1200px;
            }
            
            /* 菜单列表调整 */
            .menu-list-container,
            .selected-dishes-container,
            .all-dishes-container {
                max-height: 400px;
            }
        }
        
        /* 角色主题颜色 */
        .theme-blue {
            background-color: #3498db !important;
        }
        
        .theme-green {
            background-color: #27ae60 !important;
        }
        
        .theme-pink {
            background-color: #FF99A8 !important;
        }
        
        /* 主题颜色对应的元素 */
        .theme-blue .card-header,
        .theme-blue .btn-primary {
            background-color: #3498db !important;
            border-color: #3498db !important;
        }
        
        .theme-green .card-header,
        .theme-green .btn-primary {
            background-color: #27ae60 !important;
            border-color: #27ae60 !important;
        }
        
        .theme-pink .card-header,
        .theme-pink .btn-primary {
            background-color: #FF99A8 !important;
            border-color: #FF99A8 !important;
        }
        
        .theme-blue .page-title {
            color: #3498db !important;
            border-bottom-color: #3498db !important;
        }
        
        .theme-green .page-title {
            color: #27ae60 !important;
            border-bottom-color: #27ae60 !important;
        }
        
        .theme-pink .page-title {
            color: #FF99A8 !important;
            border-bottom-color: #FF99A8 !important;
        }
        
        .theme-blue .info-card i {
            color: #3498db !important;
        }
        
        .theme-green .info-card i {
            color: #27ae60 !important;
        }
        
        .theme-pink .info-card i {
            color: #FF99A8 !important;
        }
        
        /* 移动端菜单样式 */
        @media (max-width: 768px) {
            .navbar-collapse {
                background-color: #4CAF50;
                border-radius: 0 0 8px 8px;
                padding: 1rem;
                margin-top: 0.5rem;
            }
            
            .navbar.theme-blue .navbar-collapse {
                background-color: #3498db;
            }
            
            .navbar.theme-green .navbar-collapse {
                background-color: #27ae60;
            }
            
            .navbar.theme-pink .navbar-collapse {
                background-color: #FF99A8;
            }
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }
        
        /* 页面加载动画 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 按钮交互效果 */
        .btn {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* 卡片悬停效果 */
        .card {
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* 导航栏交互效果 */
        .navbar-nav .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .navbar-nav .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: rgba(255, 255, 255, 0.8);
            transition: width 0.3s ease;
        }
        
        .navbar-nav .nav-link:hover::after {
            width: 100%;
        }
        
        /* 表单元素交互效果 */
        .form-control {
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
            transform: translateY(-1px);
        }
        
        /* 平滑滚动 */
        html {
            scroll-behavior: smooth;
        }
        
        /* 淡入效果 */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 表格行悬停效果 */
        .table-hover tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
            transform: translateX(5px);
            transition: all 0.2s ease;
        }
        
        /* 标签页交互效果 */
        #menuTabs .nav-tabs .nav-link,
        #menuTabs .nav-link {
            transition: all 0.3s ease;
            color: #212529 !important;
            font-weight: 600 !important;
            padding: 10px 15px !important;
            font-size: 16px !important;
            background-color: #f8f9fa !important;
            border: 1px solid #dee2e6 !important;
        }
        
        #menuTabs .nav-tabs .nav-link i,
        #menuTabs .nav-link i {
            color: #212529 !important;
            margin-right: 8px;
        }
        
        #menuTabs .nav-tabs .nav-link:hover,
        #menuTabs .nav-link:hover {
            background-color: rgba(52, 152, 219, 0.1) !important;
            border-color: rgba(52, 152, 219, 0.3) !important;
            color: #0d6efd !important;
        }
        
        #menuTabs .nav-tabs .nav-link:hover i,
        #menuTabs .nav-link:hover i {
            color: #0d6efd !important;
        }
        
        #menuTabs .nav-tabs .nav-link.active,
        #menuTabs .nav-link.active {
            background-color: #ffffff !important;
            border-color: #dee2e6 #dee2e6 #ffffff !important;
            color: #0d6efd !important;
            font-weight: 700 !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
        }
        
        #menuTabs .nav-tabs .nav-link.active i,
        #menuTabs .nav-link.active i {
            color: #0d6efd !important;
        }
        
        /* 模态框动画效果 */
        .modal {
            transition: opacity 0.3s ease;
        }
        
        .modal.show {
            opacity: 1;
        }
        
        .modal-content {
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">上海巍阁公司管理系统</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#home-page">
                            <i class="fas fa-home me-1"></i> 首页
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="confinementDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-baby me-1"></i> 月子餐管理
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="confinementDropdown">
                            <li><a class="dropdown-item" href="#menus">
                                <i class="fas fa-utensils me-1"></i> 菜单管理
                            </a></li>
                            <li><a class="dropdown-item" href="#daily-menus">
                                <i class="fas fa-calendar-day me-1"></i> 每日餐单
                            </a></li>
                            <li><a class="dropdown-item" href="#dishes">
                                <i class="fas fa-utensil-fork me-1"></i> 菜品管理
                            </a></li>
                            <li><a class="dropdown-item" href="#ingredients">
                                <i class="fas fa-shopping-basket me-1"></i> 食材管理
                            </a></li>
                            <li><a class="dropdown-item" href="#packages">
                                <i class="fas fa-gift me-1"></i> 套餐定制
                            </a></li>
                            <li><a class="dropdown-item" href="#customer-orders">
                                <i class="fas fa-clipboard-list me-1"></i> 客户订餐
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#customers">
                            <i class="fas fa-users me-1"></i> 客户管理
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="financeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-chart-line me-1"></i> 财务管理
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="financeDropdown">
                            <li><a class="dropdown-item" href="#cost-calculation">
                                <i class="fas fa-calculator me-1"></i> 成本计算
                            </a></li>
                            <li><a class="dropdown-item" href="#budget-management">
                                <i class="fas fa-wallet me-1"></i> 预算管理
                            </a></li>
                            <li><a class="dropdown-item" href="#financial-reports">
                                <i class="fas fa-file-invoice-dollar me-1"></i> 财务报表
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="employeeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-users-cog me-1"></i> 员工管理
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="employeeDropdown">
                            <li><a class="dropdown-item" href="#employees">
                                <i class="fas fa-user-tie me-1"></i> 员工信息
                            </a></li>
                            <li><a class="dropdown-item" href="#permissions">
                                <i class="fas fa-lock me-1"></i> 权限管理
                            </a></li>
                            <li><a class="dropdown-item" href="#attendance">
                                <i class="fas fa-calendar-check me-1"></i> 考勤管理
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="systemDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-tools me-1"></i> 系统管理
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="systemDropdown">
                            <li><a class="dropdown-item" href="#reports">
                                <i class="fas fa-file-pdf me-1"></i> 报表打印
                            </a></li>
                            <li><a class="dropdown-item" href="#system-config">
                                <i class="fas fa-cog me-1"></i> 系统配置
                            </a></li>
                            <li><a class="dropdown-item" href="#data-backup">
                                <i class="fas fa-database me-1"></i> 数据备份
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="helpDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-question-circle me-1"></i> 帮助
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="helpDropdown">
                            <li><a class="dropdown-item" href="#user-guide">
                                <i class="fas fa-book me-1"></i> 使用指南
                            </a></li>
                            <li><a class="dropdown-item" href="#faq">
                                <i class="fas fa-question-circle me-1"></i> 常见问题
                            </a></li>
                            <li><a class="dropdown-item" href="#contact-us">
                                <i class="fas fa-envelope me-1"></i> 联系我们
                            </a></li>
                            <li><a class="dropdown-item" href="#about">
                                <i class="fas fa-info-circle me-1"></i> 关于系统
                            </a></li>
                        </ul>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button class="btn btn-outline-light me-2" data-bs-toggle="modal" data-bs-target="#loginModal">登录</button>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#registerModal">注册</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 主内容 -->
    <div class="container mt-4">
        <!-- 未登录状态显示的内容 -->
        <div id="guest-content" class="mt-5">
            <div class="card">
                <div class="card-header">
                    欢迎使用餐食管理系统
                </div>
                <div class="card-body">
                    <p class="lead">请登录或注册以使用系统功能</p>
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    服务介绍
                                </div>
                                <div class="card-body">
                                    <h5>服务内容</h5>
                                    <ul class="list-group">
                                        <li class="list-group-item">专业餐饮服务</li>
                                        <li class="list-group-item">个性化菜单定制</li>
                                        <li class="list-group-item">营养健康咨询</li>
                                        <li class="list-group-item">24小时客服支持</li>
                                    </ul>
                                    <h5 class="mt-4">菜品展示</h5>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6>营养早餐</h6>
                                                    <p>多种谷物、新鲜水果、蛋白质丰富</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6>健康午餐</h6>
                                                    <p>均衡营养、低盐低脂、美味可口</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6>养生晚餐</h6>
                                                    <p>清淡易消化、营养丰富、助眠安神</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    入院须知
                                </div>
                                <div class="card-body">
                                    <p>1. 请遵守医院的各项规章制度</p>
                                    <p>2. 保持病房整洁，爱护公共设施</p>
                                    <p>3. 按时就餐，如有特殊饮食需求请提前告知</p>
                                    <p>4. 如有任何问题，请及时与工作人员联系</p>
                                </div>
                            </div>
                            <div class="card mt-4">
                                <div class="card-header">
                                    联系方式
                                </div>
                                <div class="card-body">
                                    <p>电话：12345678901</p>
                                    <p>邮箱：contact@example.com</p>
                                    <p>地址：北京市海淀区医院路1号</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 登录后显示的内容 -->
        <div id="user-content" style="display: none;">
            <!-- 首页仪表盘 -->
            <div id="home-page" class="mt-5">
                <h1 class="page-title">
                    <i class="fas fa-chart-bar"></i> 仪表盘
                </h1>
                <div class="row">
                    <div class="col-md-3">
                        <div class="info-card">
                            <i class="fas fa-utensils"></i>
                            <h3>菜单数量</h3>
                            <p class="text-center" id="menu-count">0</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="info-card">
                            <i class="fas fa-calendar-day"></i>
                            <h3>每日餐单</h3>
                            <p class="text-center" id="daily-menu-count">0</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="info-card">
                            <i class="fas fa-users"></i>
                            <h3>客户数量</h3>
                            <p class="text-center" id="customer-count">0</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="info-card">
                            <i class="fas fa-user-check"></i>
                            <h3>活跃访客</h3>
                            <p class="text-center" id="guest-count">0</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-calendar-alt"></i> 近期日程
                            </div>
                            <div class="card-body">
                                <div id="schedule-list">
                                    <!-- 日程将通过JavaScript动态添加 -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-bell"></i> 通知中心
                            </div>
                            <div class="card-body">
                                <div id="notification-list">
                                    <!-- 通知将通过JavaScript动态添加 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 菜单管理 -->
            <div id="menus" class="mt-5">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0"><i class="fas fa-utensils"></i> 菜单管理</h4>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="menuTabs">
                            <li class="nav-item">
                                <a class="nav-link active" id="basicMenuTab" href="#basic-menu" data-bs-toggle="tab">
                                    <i class="fas fa-calendar-week"></i> 基础餐单
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="menuManagementTab" href="#menu-management" data-bs-toggle="tab">
                                    <i class="fas fa-list"></i> 菜单配置
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="dishCategoryTab" href="#dish-category" data-bs-toggle="tab">
                                    <i class="fas fa-tags"></i> 菜品分类
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="nutritionAnalysisTab" href="#nutrition-analysis" data-bs-toggle="tab">
                                    <i class="fas fa-chart-pie"></i> 营养分析
                                </a>
                            </li>
                        </ul>
                        
                        <div class="tab-content mt-4">
                            <!-- 基本菜单页 -->
                            <div class="tab-pane fade show active" id="basic-menu">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-body">
                                        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
                                                <div class="flex-grow-1 me-3" style="min-width: 200px;">
                                                    <label for="weekSelector" class="form-label fw-bold">
                                                        <i class="fas fa-calendar-alt"></i> 选择周数
                                                    </label>
                                                    <select class="form-control" id="weekSelector">
                                                        <option value="1">第1周</option>
                                                        <option value="2">第2周</option>
                                                        <option value="3">第3周</option>
                                                        <option value="4">第4周</option>
                                                        <option value="5">第5周</option>
                                                    </select>
                                                </div>
                                                <div class="d-flex align-items-end gap-2 flex-wrap">
                                                    <div class="mb-2 me-2">
                                                        <input type="file" class="form-control" id="basicMenuFile" accept=".xlsx,.xls" style="display: none;">
                                                        <label for="basicMenuFile" class="btn btn-info mb-0">
                                                            <i class="fas fa-file-import"></i> 导入Excel
                                                        </label>
                                                    </div>
                                                    <button class="btn btn-warning mb-2" id="saveToServerBtn" onclick="saveBasicMenuToServer()" disabled>
                                                        <i class="fas fa-save"></i> 保存到服务器
                                                    </button>
                                                    <button class="btn btn-primary mb-2" onclick="loadBasicMenu()">
                                                        <i class="fas fa-sync-alt"></i> 刷新数据
                                                    </button>
                                                    <button class="btn btn-success mb-2" onclick="exportBasicMenuToExcel()">
                                                        <i class="fas fa-file-excel"></i> 导出Excel
                                                    </button>
                                                </div>
                                            </div>
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-striped table-hover">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th class="bg-primary text-white">餐别</th>
                                                        <th class="bg-info text-white">周六</th>
                                                        <th class="bg-info text-white">周日</th>
                                                        <th class="bg-success text-white">周一</th>
                                                        <th class="bg-success text-white">周二</th>
                                                        <th class="bg-success text-white">周三</th>
                                                        <th class="bg-success text-white">周四</th>
                                                        <th class="bg-success text-white">周五</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="basicMenuTableBody">
                                                    <!-- 基本菜单数据将通过JavaScript动态添加 -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 菜单管理页 -->
                            <div class="tab-pane fade" id="menu-management">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-cog"></i> 菜单配置</h5>
                                        <div>
                                            <button class="btn btn-success me-2" id="uploadScheduleBtn">
                                                <i class="fas fa-upload"></i> 上传排餐表
                                            </button>
                                            <button class="btn btn-primary" id="addMenuBtn" style="display: none;">
                                                <i class="fas fa-plus"></i> 添加菜单
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <!-- 上传Excel文件 -->
                                        <div class="upload-form" id="upload-schedule" style="display: none;">
                                            <div class="card border-info">
                                                <div class="card-header bg-info text-white">
                                                    <h5 class="mb-0"><i class="fas fa-file-upload"></i> 上传排餐表</h5>
                                                </div>
                                                <div class="card-body">
                                                    <form id="uploadForm" enctype="multipart/form-data">
                                                        <div class="mb-3">
                                                            <label for="file" class="form-label fw-bold">
                                                                <i class="fas fa-file-excel"></i> 选择Excel文件
                                                            </label>
                                                            <input type="file" class="form-control" id="file" name="file" accept=".xlsx,.xls" required>
                                                            <small class="form-text text-muted">支持上传基础餐单和每日厨房餐单Excel文件</small>
                                                        </div>
                                                        <div class="d-flex gap-2">
                                                            <button type="submit" class="btn btn-primary">
                                                                <i class="fas fa-upload"></i> 上传并解析
                                                            </button>
                                                            <button type="button" class="btn btn-secondary" id="cancelUploadBtn">
                                                                <i class="fas fa-times"></i> 取消
                                                            </button>
                                                        </div>
                                                    </form>
                                                    <div id="uploadMessage" class="alert mt-3" style="display: none;"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 菜单列表和详情 -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 菜品分类页 -->
                            <div class="tab-pane fade" id="dish-category">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-tags"></i> 菜品分类管理</h5>
                                        <button class="btn btn-primary" id="addCategoryBtn">
                                            <i class="fas fa-plus"></i> 添加分类
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>分类ID</th>
                                                        <th>分类名称</th>
                                                        <th>描述</th>
                                                        <th>菜品数量</th>
                                                        <th>操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="categoryTableBody">
                                                    <!-- 分类数据将通过JavaScript动态生成 -->
                                                    <tr>
                                                        <td colspan="5" class="text-center py-4">
                                                            <i class="fas fa-info-circle text-muted me-1"></i> 暂无分类数据
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 营养分析页 -->
                            <div class="tab-pane fade" id="nutrition-analysis">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fas fa-chart-pie"></i> 菜单营养分析</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-4">
                                            <label for="nutritionWeekSelector" class="form-label fw-bold">
                                                <i class="fas fa-calendar-alt"></i> 选择周数
                                            </label>
                                            <select class="form-control" id="nutritionWeekSelector">
                                                <option value="1">第1周</option>
                                                <option value="2">第2周</option>
                                                <option value="3">第3周</option>
                                                <option value="4">第4周</option>
                                                <option value="5">第5周</option>
                                            </select>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="card mb-4">
                                                    <div class="card-header bg-primary text-white">
                                                        <h6 class="mb-0"><i class="fas fa-chart-bar"></i> 营养成分分布</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <canvas id="nutritionChart" height="300"></canvas>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card mb-4">
                                                    <div class="card-header bg-success text-white">
                                                        <h6 class="mb-0"><i class="fas fa-chart-line"></i> 每日热量摄入</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <canvas id="calorieChart" height="300"></canvas>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="card mb-4">
                                            <div class="card-header bg-info text-white">
                                                <h6 class="mb-0"><i class="fas fa-list-alt"></i> 营养建议</h6>
                                            </div>
                                            <div class="card-body">
                                                <ul class="list-group list-group-flush">
                                                    <li class="list-group-item">
                                                        <i class="fas fa-check-circle text-success me-1"></i> 蛋白质摄入充足，符合推荐标准
                                                    </li>
                                                    <li class="list-group-item">
                                                        <i class="fas fa-exclamation-triangle text-warning me-1"></i> 碳水化合物略高，建议适当减少
                                                    </li>
                                                    <li class="list-group-item">
                                                        <i class="fas fa-check-circle text-success me-1"></i> 膳食纤维摄入合理
                                                    </li>
                                                    <li class="list-group-item">
                                                        <i class="fas fa-exclamation-triangle text-warning me-1"></i> 脂肪含量偏高，建议选择健康脂肪
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 每日餐单 -->
            <div id="daily-menus" class="mt-5" style="display: none;">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>每日餐单</span>
                        <div>
                            <button class="btn btn-outline-primary btn-sm me-2" id="prevDayBtn">&lt; 前一天</button>
                            <button class="btn btn-outline-primary btn-sm" id="nextDayBtn">后一天 &gt;</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="dateFilter" class="form-label">选择日期</label>
                            <input type="date" class="form-control" id="dateFilter">
                        </div>
                        <div id="dailyMenuContent">
                            <!-- 每日餐单详情将通过JavaScript动态添加 -->
                        </div>
                        <div id="noDailyMenuRecord" class="text-center text-muted" style="display: none;">
                            没有查询到相关记录！
                        </div>
                    </div>
                </div>
            </div>

            <!-- 客户管理 -->
            <div id="customers" class="mt-5" style="display: none;">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>客户管理</span>
                        <div>
                            <button class="btn btn-primary" id="addCustomerBtn" style="display: none;">添加客户</button>
                            <button class="btn btn-info" id="searchCustomerBtn">查询</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="customerNameFilter" class="form-label">客户姓名</label>
                            <input type="text" class="form-control" id="customerNameFilter" placeholder="请输入客户姓名">
                        </div>
                        <div id="customerDetailContent" style="display: none;">
                            <div class="row">
                                <!-- 母亲表单 -->
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            <h6 class="mb-0">母亲信息</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label class="form-label">姓名</label>
                                                    <input type="text" class="form-control" id="motherName" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">年龄</label>
                                                    <input type="number" class="form-control" id="motherAge" readonly>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-md-6">
                                                    <label class="form-label">联系电话</label>
                                                    <input type="text" class="form-control" id="motherPhone" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">入住日期</label>
                                                    <input type="date" class="form-control" id="motherCheckInDate" readonly>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-md-6">
                                                    <label class="form-label">退房日期</label>
                                                    <input type="date" class="form-control" id="motherCheckOutDate" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">禁忌</label>
                                                    <input type="text" class="form-control" id="motherRestrictions" readonly>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-md-12">
                                                    <label class="form-label">备注</label>
                                                    <textarea class="form-control" id="motherNotes" rows="3" readonly></textarea>
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <button class="btn btn-primary" id="editMotherBtn" style="display: none;">编辑</button>
                                                <button class="btn btn-success" id="saveMotherBtn" style="display: none;">保存</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 孩子表单 -->
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header bg-success text-white">
                                            <h6 class="mb-0">孩子信息</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label class="form-label">姓名</label>
                                                    <input type="text" class="form-control" id="childName" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">年龄</label>
                                                    <input type="number" class="form-control" id="childAge" readonly>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-md-6">
                                                    <label class="form-label">性别</label>
                                                    <select class="form-control" id="childGender" disabled>
                                                        <option value="">请选择</option>
                                                        <option value="男">男</option>
                                                        <option value="女">女</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">出生日期</label>
                                                    <input type="date" class="form-control" id="childBirthDate" readonly>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-md-6">
                                                    <label class="form-label">体重</label>
                                                    <input type="number" class="form-control" id="childWeight" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">身高</label>
                                                    <input type="number" class="form-control" id="childHeight" readonly>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-md-6">
                                                    <label class="form-label">过敏史</label>
                                                    <input type="text" class="form-control" id="childAllergies" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">禁忌</label>
                                                    <input type="text" class="form-control" id="childRestrictions" readonly>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-md-12">
                                                    <label class="form-label">特殊需求</label>
                                                    <textarea class="form-control" id="childSpecialNeeds" rows="3" readonly></textarea>
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <button class="btn btn-primary" id="editChildBtn" style="display: none;">编辑</button>
                                                <button class="btn btn-success" id="saveChildBtn" style="display: none;">保存</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="noCustomerSelected" class="text-center text-muted">
                            请输入客户姓名进行查询
                        </div>
                    </div>
                </div>
            </div>

            <!-- 菜品管理 -->
            <div id="dishes" class="mt-5" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        菜品管理
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" href="#dishes-list" data-bs-toggle="tab">菜品</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#ingredients-list" data-bs-toggle="tab">食材</a>
                            </li>
                        </ul>
                        <div class="tab-content mt-3">
                            <!-- 菜品列表 -->
                            <div class="tab-pane fade show active" id="dishes-list">
                                <div class="mb-3">
                                    <button class="btn btn-primary" id="addDishBtn" style="display: none;">添加菜品</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover table-bordered table-striped">
                                        <thead class="table-light">
                                            <tr>
                                                <th>ID</th>
                                                <th>菜品名称</th>
                                                <th>食材组成</th>
                                                <th>禁忌</th>
                                                <th>分类</th>
                                                <th>价格</th>
                                                <th>重量</th>
                                                <th>制作厨师</th>
                                                <th>开发时间</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dishesTableBody">
                                            <!-- 菜品数据将通过JavaScript动态添加 -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- 食材列表 -->
                            <div class="tab-pane fade" id="ingredients-list">
                                <div class="mb-3">
                                    <button class="btn btn-primary" id="addIngredientBtn" style="display: none;">添加食材</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover table-bordered table-striped">
                                        <thead class="table-light">
                                            <tr>
                                                <th>ID</th>
                                                <th>食材名称</th>
                                                <th>价格</th>
                                                <th>重量</th>
                                                <th>供应商</th>
                                                <th>营养成分</th>
                                                <th>热量值</th>
                                                <th>购买时间</th>
                                                <th>保质期</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ingredientsTableBody">
                                            <!-- 食材数据将通过JavaScript动态添加 -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 管理员专属内容 -->
        <div id="admin-content" style="display: none;">
            <!-- 员工管理页面 -->
            <div id="employees" class="mt-5">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>员工管理</span>
                        <button class="btn btn-primary" id="addEmployeeBtn">添加员工</button>
                    </div>
                    <div class="card-body">
                        <!-- 员工查询表单 -->
                        <div class="mb-4">
                            <h5>员工查询</h5>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="searchName" class="form-label">姓名</label>
                                        <input type="text" class="form-control" id="searchName">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="searchIdCard" class="form-label">身份证号码</label>
                                        <input type="text" class="form-control" id="searchIdCard">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">查询</label>
                                        <button class="btn btn-primary w-100" onclick="searchEmployee()">查询员工</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 员工列表 -->
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>姓名</th>
                                    <th>职位</th>
                                    <th>联系方式</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="employeesTableBody">
                                <!-- 员工数据将通过JavaScript动态添加 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 财务管理页面 -->
            <div id="finance" class="mt-5" style="display: none;">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>财务管理</span>
                        <button class="btn btn-primary" id="addFinanceBtn">添加财务记录</button>
                    </div>
                    <div class="card-body">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>日期</th>
                                    <th>类型</th>
                                    <th>金额</th>
                                    <th>描述</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="financeTableBody">
                                <!-- 财务数据将通过JavaScript动态添加 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 报表打印页面 -->
            <div id="reports" class="mt-5" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        报表打印
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        菜单报表
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="menuReportWeek" class="form-label">选择周数</label>
                                            <select class="form-control" id="menuReportWeek">
                                                <option value="1">第1周</option>
                                                <option value="2">第2周</option>
                                                <option value="3">第3周</option>
                                                <option value="4">第4周</option>
                                                <option value="5">第5周</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-primary w-100 mb-2" onclick="generateMenuReport()">
                                            <i class="fas fa-file-alt"></i> 生成菜单报表
                                        </button>
                                        <button class="btn btn-success w-100 mb-2" onclick="printMenuReport()">
                                            <i class="fas fa-print"></i> 打印菜单报表
                                        </button>
                                        <button class="btn btn-info w-100" onclick="exportMenuToExcel()">
                                            <i class="fas fa-file-excel"></i> 导出Excel
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        客户报表
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="customerReportDate" class="form-label">选择日期</label>
                                            <input type="date" class="form-control" id="customerReportDate">
                                        </div>
                                        <button class="btn btn-primary w-100 mb-2">
                                            <i class="fas fa-file-alt"></i> 生成客户报表
                                        </button>
                                        <button class="btn btn-success w-100">
                                            <i class="fas fa-print"></i> 打印客户报表
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        财务报表
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="financeReportMonth" class="form-label">选择月份</label>
                                            <input type="month" class="form-control" id="financeReportMonth">
                                        </div>
                                        <button class="btn btn-primary w-100 mb-2">
                                            <i class="fas fa-file-alt"></i> 生成财务报表
                                        </button>
                                        <button class="btn btn-success w-100">
                                            <i class="fas fa-print"></i> 打印财务报表
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mt-3">
                                <div class="card">
                                    <div class="card-header">
                                        员工报表
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="employeeReportDepartment" class="form-label">选择部门</label>
                                            <select class="form-control" id="employeeReportDepartment">
                                                <option value="all">全部部门</option>
                                                <option value="kitchen">厨房</option>
                                                <option value="service">服务部</option>
                                                <option value="admin">行政部</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-primary w-100 mb-2">
                                            <i class="fas fa-file-alt"></i> 生成员工报表
                                        </button>
                                        <button class="btn btn-success w-100">
                                            <i class="fas fa-print"></i> 打印员工报表
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 报表预览区域 -->
                        <div class="mt-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>报表预览</h5>
                                </div>
                                <div class="card-body">
                                    <div id="reportPreview">
                                        <p class="text-center text-muted">请先生成报表查看预览</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页面加载动画 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- 模态框 -->
    <div class="modal fade" id="menuDetailModal" tabindex="-1" aria-labelledby="menuDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="menuDetailModalLabel">菜单详情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="menuDetailBody">
                    <!-- 菜单详情将通过JavaScript动态添加 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 客户编辑模态框 -->
    <div class="modal fade" id="customerEditModal" tabindex="-1" aria-labelledby="customerEditModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customerEditModalLabel">编辑客户信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="customerEditForm">
                        <input type="hidden" id="customerId">
                        
                        <!-- 基本信息 -->
                        <div class="mb-4">
                            <h5>基本信息</h5>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="customerName" class="form-label">姓名</label>
                                        <input type="text" class="form-control" id="customerName" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="customerRestrictions" class="form-label">禁忌</label>
                                        <input type="text" class="form-control" id="customerRestrictions">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="customerCheckInDate" class="form-label">入住日期</label>
                                        <input type="date" class="form-control" id="customerCheckInDate">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="customerCheckOutDate" class="form-label">退房日期</label>
                                        <input type="date" class="form-control" id="customerCheckOutDate">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 妈妈详细信息 -->
                        <div class="mb-4">
                            <h5>妈妈详细信息</h5>
                            
                            <!-- 孕期健康信息 -->
                            <div class="mb-3">
                                <h6>孕期健康信息</h6>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="conceptionMethod" class="form-label">受孕方式</label>
                                            <input type="text" class="form-control" id="conceptionMethod">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="pregnancyDiseases" class="form-label">孕期疾病</label>
                                            <input type="text" class="form-control" id="pregnancyDiseases">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="fetalProtection" class="form-label">保胎治疗</label>
                                            <select class="form-control" id="fetalProtection">
                                                <option value="">请选择</option>
                                                <option value="是">是</option>
                                                <option value="否">否</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="surgeryHistory" class="form-label">手术史</label>
                                            <select class="form-control" id="surgeryHistory">
                                                <option value="">请选择</option>
                                                <option value="是">是</option>
                                                <option value="否">否</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label for="geneticDiseases" class="form-label">遗传疾病</label>
                                            <input type="text" class="form-control" id="geneticDiseases">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 产妇入院检查项目 -->
                            <div class="mb-3">
                                <h6>产妇入院检查项目</h6>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="bloodType" class="form-label">血型</label>
                                            <input type="text" class="form-control" id="bloodType">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="bloodPressure" class="form-label">血压值 (mmHg)</label>
                                            <input type="text" class="form-control" id="bloodPressure">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="weight" class="form-label">体重 (KG)</label>
                                            <input type="text" class="form-control" id="weight">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="temperature" class="form-label">体温 (°C)</label>
                                            <input type="text" class="form-control" id="temperature">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="pulse" class="form-label">脉搏</label>
                                            <input type="text" class="form-control" id="pulse">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="prePregnancyWeight" class="form-label">孕前体重 (KG)</label>
                                            <input type="text" class="form-control" id="prePregnancyWeight">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="productionHospital" class="form-label">生产医院</label>
                                            <input type="text" class="form-control" id="productionHospital">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label for="productionDate" class="form-label">生产日期</label>
                                            <input type="date" class="form-control" id="productionDate">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 宝宝详细信息 -->
                        <div class="mb-4">
                            <h5>宝宝详细信息</h5>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="babyName" class="form-label">宝宝姓名</label>
                                        <input type="text" class="form-control" id="babyName">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="babyGender" class="form-label">性别</label>
                                        <select class="form-control" id="babyGender">
                                            <option value="">请选择</option>
                                            <option value="男">男</option>
                                            <option value="女">女</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="babyBirthDate" class="form-label">出生日期</label>
                                        <input type="date" class="form-control" id="babyBirthDate">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="babyBirthWeight" class="form-label">出生体重 (g)</label>
                                        <input type="text" class="form-control" id="babyBirthWeight">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="babyBirthHeight" class="form-label">出生身高 (cm)</label>
                                        <input type="text" class="form-control" id="babyBirthHeight">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveCustomerChanges">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 菜品编辑模态框 -->
    <div class="modal fade" id="dishEditModal" tabindex="-1" aria-labelledby="dishEditModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dishEditModalLabel">编辑菜品信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="dishEditForm">
                        <input type="hidden" id="dishId">
                        <div class="mb-3">
                            <label for="dishName" class="form-label">菜品名称</label>
                            <input type="text" class="form-control" id="dishName" required>
                        </div>
                        <div class="mb-3">
                            <label for="dishIngredients" class="form-label">食材组成</label>
                            <input type="text" class="form-control" id="dishIngredients">
                        </div>
                        <div class="mb-3">
                            <label for="dishRestrictions" class="form-label">禁忌</label>
                            <input type="text" class="form-control" id="dishRestrictions">
                        </div>
                        <div class="mb-3">
                            <label for="dishCategory" class="form-label">分类</label>
                            <select class="form-control" id="dishCategory">
                                <option value="1">早餐</option>
                                <option value="2">午餐</option>
                                <option value="3">晚餐</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveDishChanges">保存</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 食材编辑模态框 -->
    <div class="modal fade" id="ingredientEditModal" tabindex="-1" aria-labelledby="ingredientEditModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ingredientEditModalLabel">编辑食材信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="ingredientEditForm">
                        <input type="hidden" id="ingredientId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ingredientName" class="form-label">食材名称</label>
                                    <input type="text" class="form-control" id="ingredientName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="ingredientWeight" class="form-label">重量</label>
                                    <input type="text" class="form-control" id="ingredientWeight">
                                </div>
                                <div class="mb-3">
                                    <label for="ingredientPrice" class="form-label">价格</label>
                                    <input type="text" class="form-control" id="ingredientPrice">
                                </div>
                                <div class="mb-3">
                                    <label for="ingredientRestrictions" class="form-label">禁忌</label>
                                    <input type="text" class="form-control" id="ingredientRestrictions">
                                </div>
                                <div class="mb-3">
                                    <label for="ingredientSupplier" class="form-label">供应商</label>
                                    <input type="text" class="form-control" id="ingredientSupplier">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ingredientNutrition" class="form-label">营养成分</label>
                                    <input type="text" class="form-control" id="ingredientNutrition">
                                </div>
                                <div class="mb-3">
                                    <label for="ingredientCalories" class="form-label">热值</label>
                                    <input type="text" class="form-control" id="ingredientCalories">
                                </div>
                                <div class="mb-3">
                                    <label for="ingredientPurchaseDate" class="form-label">购买日期</label>
                                    <input type="date" class="form-control" id="ingredientPurchaseDate">
                                </div>
                                <div class="mb-3">
                                    <label for="ingredientProcessingDate" class="form-label">加工日期</label>
                                    <input type="date" class="form-control" id="ingredientProcessingDate">
                                </div>
                                <div class="mb-3">
                                    <label for="ingredientShelfLife" class="form-label">保质期</label>
                                    <input type="text" class="form-control" id="ingredientShelfLife">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveIngredientChanges">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 登录模态框 -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">用户登录</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginUsername" class="form-label">用户名</label>
                            <input type="text" class="form-control" id="loginUsername" required onkeypress="if(event.keyCode==13) document.getElementById('loginPassword').focus();">
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">密码</label>
                            <input type="password" class="form-control" id="loginPassword" required onkeypress="if(event.keyCode==13) document.getElementById('loginButton').click();">
                        </div>
                    </form>
                    <div id="loginMessage" class="alert" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="loginButton">登录</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 访客注册模态框 -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel">访客注册</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="registerUsername" class="form-label">用户名</label>
                                    <input type="text" class="form-control" id="registerUsername" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerPassword" class="form-label">密码</label>
                                    <input type="password" class="form-control" id="registerPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerName" class="form-label">姓名</label>
                                    <input type="text" class="form-control" id="registerName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerGender" class="form-label">性别</label>
                                    <select class="form-control" id="registerGender" required>
                                        <option value="">请选择</option>
                                        <option value="男">男</option>
                                        <option value="女">女</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="registerAge" class="form-label">年龄</label>
                                    <input type="number" class="form-control" id="registerAge" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="registerBirthdate" class="form-label">出生日期</label>
                                    <input type="date" class="form-control" id="registerBirthdate" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerStayDays" class="form-label">计划入住天数</label>
                                    <input type="number" class="form-control" id="registerStayDays" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerPhone" class="form-label">联系电话</label>
                                    <input type="tel" class="form-control" id="registerPhone" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerRestrictions" class="form-label">饮食禁忌</label>
                                    <textarea class="form-control" id="registerRestrictions" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div id="registerMessage" class="alert" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="registerButton">注册</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加菜单模态框 -->
    <div class="modal fade" id="addMenuModal" tabindex="-1" aria-labelledby="addMenuModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addMenuModalLabel">添加菜单</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addMenuForm">
                        <!-- 菜单基本信息 -->
                        <div class="mb-4">
                            <h5>菜单基本信息</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="addMenuName" class="form-label">菜单名称</label>
                                        <input type="text" class="form-control" id="addMenuName" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="addMenuPrice" class="form-label">价格</label>
                                        <input type="number" class="form-control" id="addMenuPrice" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label for="addMenuFeatures" class="form-label">菜单特色</label>
                                        <textarea class="form-control" id="addMenuFeatures" rows="2"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="addMenuNutrition" class="form-label">营养成分</label>
                                        <input type="text" class="form-control" id="addMenuNutrition">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="addMenuCalories" class="form-label">热量值</label>
                                        <input type="number" class="form-control" id="addMenuCalories">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="addMenuNutritionist" class="form-label">营养师姓名</label>
                                        <input type="text" class="form-control" id="addMenuNutritionist" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="addMenuCreateTime" class="form-label">建立时间</label>
                                        <input type="date" class="form-control" id="addMenuCreateTime" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 菜品列表 -->
                        <div class="mb-4">
                            <h5>菜品列表</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">已选菜品</label>
                                    <div class="selected-dishes-container" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; min-height: 100px;" id="addSelectedDishesList">
                                        <!-- 已选菜品将通过JavaScript动态添加 -->
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">所有菜品</label>
                                    <div class="all-dishes-container" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; min-height: 100px;" id="addAllDishesList">
                                        <!-- 所有菜品将通过JavaScript动态添加 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div id="addMenuMessage" class="alert" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveMenuButton">保存</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加员工模态框 -->
    <div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addEmployeeModalLabel">添加员工</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addEmployeeForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="employeeName" class="form-label">姓名</label>
                                    <input type="text" class="form-control" id="employeeName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeGender" class="form-label">性别</label>
                                    <select class="form-control" id="employeeGender" required>
                                        <option value="">请选择</option>
                                        <option value="男">男</option>
                                        <option value="女">女</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeBirthdate" class="form-label">出生年月</label>
                                    <input type="date" class="form-control" id="employeeBirthdate" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeEthnicity" class="form-label">民族</label>
                                    <input type="text" class="form-control" id="employeeEthnicity" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeDepartment" class="form-label">部门</label>
                                    <input type="text" class="form-control" id="employeeDepartment" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeePosition" class="form-label">岗位</label>
                                    <input type="text" class="form-control" id="employeePosition" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeIdCard" class="form-label">身份证号码</label>
                                    <input type="text" class="form-control" id="employeeIdCard" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeAddress" class="form-label">家庭住址</label>
                                    <input type="text" class="form-control" id="employeeAddress" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="employeePhone" class="form-label">联系方式</label>
                                    <input type="tel" class="form-control" id="employeePhone" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeEmergencyContact" class="form-label">紧急联系人</label>
                                    <input type="text" class="form-control" id="employeeEmergencyContact" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeEmergencyPhone" class="form-label">紧急联系人电话</label>
                                    <input type="tel" class="form-control" id="employeeEmergencyPhone" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeHometown" class="form-label">籍贯</label>
                                    <input type="text" class="form-control" id="employeeHometown" required>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeEducation" class="form-label">教育经历</label>
                                    <textarea class="form-control" id="employeeEducation" rows="2"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeWorkExperience" class="form-label">工作经历</label>
                                    <textarea class="form-control" id="employeeWorkExperience" rows="2"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeLanguage" class="form-label">外语水平</label>
                                    <input type="text" class="form-control" id="employeeLanguage">
                                </div>
                                <div class="mb-3">
                                    <label for="employeeCertificates" class="form-label">资格证书</label>
                                    <input type="text" class="form-control" id="employeeCertificates">
                                </div>
                                <div class="mb-3">
                                    <label for="employeeEvaluation" class="form-label">近三年考核结果</label>
                                    <textarea class="form-control" id="employeeEvaluation" rows="2"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="employeeFamily" class="form-label">家庭成员</label>
                                    <textarea class="form-control" id="employeeFamily" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div id="addEmployeeMessage" class="alert" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveEmployeeButton">保存</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        // 页面加载完成后隐藏加载动画
        window.addEventListener('load', function() {
            setTimeout(function() {
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (loadingOverlay) {
                    loadingOverlay.style.opacity = '0';
                    setTimeout(function() {
                        loadingOverlay.style.display = 'none';
                    }, 300);
                }
            }, 500);
        });
        
        // 添加淡入效果到页面元素
        function addFadeInEffect() {
            const elements = document.querySelectorAll('.card, .info-card, .page-title');
            elements.forEach(function(element) {
                element.classList.add('fade-in');
            });
        }
        
        // 页面加载完成后添加淡入效果
        window.addEventListener('load', function() {
            addFadeInEffect();
        });
        
        // 上传文件
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const xhr = new XMLHttpRequest();
            
            xhr.open('POST', '/api/upload/excel', true);
            
            xhr.onload = function() {
                const response = JSON.parse(this.responseText);
                const messageDiv = document.getElementById('uploadMessage');
                
                if (this.status === 200) {
                    messageDiv.className = 'alert alert-success';
                    messageDiv.textContent = response.message;
                    // 刷新数据
                    loadMenus();
                    loadDailyMenus();
                    loadCustomers();
                    loadDishes();
                } else {
                    messageDiv.className = 'alert alert-danger';
                    messageDiv.textContent = response.error;
                }
                messageDiv.style.display = 'block';
                
                // 3秒后隐藏消息
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 3000);
            };
            
            xhr.send(formData);
        });

        // 加载菜单数据
        function loadMenus() {
            fetch('/api/menus')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    const menuList = document.getElementById('menuList');
                    menuList.innerHTML = '';
                    
                    data.forEach(function(menu) {
                        const item = document.createElement('a');
                        item.className = 'list-group-item list-group-item-action';
                        item.href = '#';
                        item.dataset.menuId = menu.id;
                        item.innerHTML = `
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">${menu.name}</h6>
                                    <small class="text-muted">${menu.description || ''}</small>
                                </div>
                                <small class="text-muted">${menu.week_number ? '第' + menu.week_number + '周' : ''}</small>
                            </div>
                        `;
                        item.onclick = function(e) {
                            e.preventDefault();
                            selectMenu(menu.id);
                        };
                        menuList.appendChild(item);
                    });
                    
                    loadBasicMenu();
                })
                .catch(function(error) {
                    console.error('Error loading menus:', error);
                });
        }

        // 存储解析后的Excel数据
        let parsedBasicMenuData = null;
        let currentExcelFile = null;
        
        // 从Excel文件加载基本菜单数据
        function loadBasicMenuFromExcel(file) {
            currentExcelFile = file;
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // 获取所有工作表
                    const sheetNames = workbook.SheetNames;
                    console.log('工作表名称:', sheetNames);
                    
                    // 存储所有工作表的数据
                    const allSheetData = {};
                    sheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        allSheetData[sheetName] = jsonData;
                        console.log(`工作表 ${sheetName} 数据:`, jsonData);
                    });
                    
                    // 存储解析后的数据
                    parsedBasicMenuData = allSheetData;
                    
                    // 解析数据并填充表格（默认显示第一个工作表）
                    const firstSheetName = sheetNames[0];
                    populateBasicMenuTable(allSheetData[firstSheetName]);
                    
                    // 启用保存到服务器按钮
                    document.getElementById('saveToServerBtn').disabled = false;
                    
                    alert('Excel数据导入成功！预览后请点击"保存到服务器"按钮保存数据。');
                } catch (error) {
                    console.error('Error parsing Excel file:', error);
                    alert('解析Excel文件失败，请确保文件格式正确');
                }
            };
            
            reader.onerror = function() {
                alert('读取Excel文件失败');
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // 填充基本菜单表格
        function populateBasicMenuTable(data) {
            const tbody = document.getElementById('basicMenuTableBody');
            tbody.innerHTML = '';
            
            // 餐别和星期（按照要求的顺序：早餐-早加-午餐-午加-晚餐-晚加）
            const mealTypes = ['早餐', '早加', '午餐', '午加', '晚餐', '晚加'];
            const days = ['周六', '周日', '周一', '周二', '周三', '周四', '周五'];
            
            // 创建一个映射来存储菜品数据
            const menuData = {};
            
            // 初始化菜单数据结构
            mealTypes.forEach(mealType => {
                menuData[mealType] = {};
                days.forEach(day => {
                    menuData[mealType][day] = [];
                });
            });
            
            // 打印数据结构，便于调试
            console.log('Excel数据:', data);
            console.log('数据行数:', data.length);
            
            // 检查数据是否为空
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center py-4">暂无数据</td></tr>';
                return;
            }
            
            // 打印前几行数据，便于调试
            console.log('前5行数据:', data.slice(0, 5));
            
            // 首先找到星期行
            let weekRowIndex = -1;
            data.forEach((row, index) => {
                const keys = Object.keys(row);
                if (keys.some(key => {
                    const value = row[key];
                    return value && value.toString().includes('周六');
                })) {
                    weekRowIndex = index;
                }
            });
            
            console.log('星期行索引:', weekRowIndex);
            
            if (weekRowIndex >= 0) {
                // 获取星期对应的列索引
                const dayMap = {};
                const weekRow = data[weekRowIndex];
                const keys = Object.keys(weekRow);
                
                keys.forEach(key => {
                    const value = weekRow[key];
                    if (value) {
                        const dayValue = value.toString().trim();
                        if (days.includes(dayValue)) {
                            dayMap[dayValue] = key;
                            console.log(`找到星期: ${dayValue} -> 列: ${key}`);
                        }
                    }
                });
                
                console.log('星期映射:', dayMap);
                
                // 从餐别行开始处理数据
                let currentMealType = null;
                
                for (let i = weekRowIndex + 1; i < data.length; i++) {
                    const row = data[i];
                    const firstCell = row[keys[0]];
                    
                    if (firstCell) {
                        const cellValue = firstCell.toString().trim();
                        
                        // 检查是否是餐别（支持多种可能的餐别名称）
                        if (mealTypes.includes(cellValue)) {
                            // 找到新的餐别
                            currentMealType = cellValue;
                            console.log(`找到餐别: ${currentMealType} 在第 ${i} 行`);
                        } else if (currentMealType) {
                            // 处理当前餐别的菜品数据
                            days.forEach(day => {
                                const dayKey = dayMap[day];
                                if (dayKey) {
                                    const dishName = row[dayKey];
                                    if (dishName) {
                                        const dishValue = dishName.toString().trim();
                                        // 过滤掉空值和横线
                                        if (dishValue !== '' && dishValue !== '-' && dishValue !== '—') {
                                            menuData[currentMealType][day].push({ name: dishValue });
                                            console.log(`添加菜品: ${dishValue} 到 ${currentMealType} ${day}`);
                                        }
                                    }
                                }
                            });
                        }
                    }
                }
            } else {
                console.log('未找到星期行，尝试其他解析方法');
                // 如果没有找到星期行，尝试其他解析方法
                // 这里可以添加备用解析逻辑
            }
            
            console.log('菜单数据:', menuData);
            
            // 填充表格
            mealTypes.forEach(function(mealType) {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="fw-bold bg-light align-middle">${mealType}</td>`;
                
                days.forEach(function(day) {
                    const cell = document.createElement('td');
                    cell.className = 'p-2 align-middle';
                    
                    const dishes = menuData[mealType][day];
                    if (dishes && dishes.length > 0) {
                        const dishList = document.createElement('div');
                        dishList.className = 'small';
                        
                        dishes.forEach(function(dish) {
                            const dishItem = document.createElement('div');
                            dishItem.className = 'mb-1';
                            dishItem.innerHTML = `${dish.name}${dish.restrictions ? `<span class="text-muted">(${dish.restrictions})</span>` : ''}`;
                            dishList.appendChild(dishItem);
                        });
                        
                        cell.appendChild(dishList);
                    } else {
                        cell.innerHTML = '<span class="text-muted">-</span>';
                    }
                    
                    row.appendChild(cell);
                });
                
                tbody.appendChild(row);
            });
        }
        
        function loadBasicMenu(weekNumber = null) {
            // 如果没有指定周数，从选择器中获取
            if (!weekNumber) {
                weekNumber = document.getElementById('weekSelector').value;
            }
            
            fetch('/api/menus')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    const tbody = document.getElementById('basicMenuTableBody');
                    tbody.innerHTML = '';
                    
                    if (data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="8" class="text-center py-4">暂无基本菜单数据</td></tr>';
                        return;
                    }
                    
                    // 根据周数查找对应的菜单
                    const menu = data.find(m => m.week_number == weekNumber);
                    if (!menu || !menu.dishes_by_day) {
                        tbody.innerHTML = '<tr><td colspan="8" class="text-center py-4">暂无第' + weekNumber + '周的菜单数据</td></tr>';
                        return;
                    }
                    
                    const mealTypes = ['早餐', '早加', '午餐', '午加', '晚餐', '晚加'];
                    const days = ['周六', '周日', '周一', '周二', '周三', '周四', '周五'];
                    
                    mealTypes.forEach(function(mealType) {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td class="fw-bold bg-light">${mealType}</td>`;
                        
                        days.forEach(function(day) {
                            const cell = document.createElement('td');
                            cell.className = 'p-2';
                            const dayIndex = days.indexOf(day) + 1;
                            
                            if (menu.dishes_by_day[dayIndex] && menu.dishes_by_day[dayIndex][mealType]) {
                                const dishes = menu.dishes_by_day[dayIndex][mealType];
                                const dishList = document.createElement('div');
                                dishList.className = 'small';
                                
                                dishes.forEach(function(dish, index) {
                                    const dishItem = document.createElement('div');
                                    dishItem.className = 'mb-1';
                                    dishItem.innerHTML = `${dish.name}${dish.restrictions ? `<span class="text-muted">(${dish.restrictions})</span>` : ''}`;
                                    dishList.appendChild(dishItem);
                                });
                                
                                cell.appendChild(dishList);
                            } else {
                                cell.innerHTML = '<span class="text-muted">-</span>';
                            }
                            
                            row.appendChild(cell);
                        });
                        
                        tbody.appendChild(row);
                    });
                })
                .catch(function(error) {
                    console.error('Error loading basic menu:', error);
                    const tbody = document.getElementById('basicMenuTableBody');
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center py-4 text-danger">加载菜单数据失败</td></tr>';
                });
        }
        
        // 初始化基本菜单Excel文件输入事件监听器
        function initBasicMenuExcelUpload() {
            // 等待DOM加载完成
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    setupBasicMenuFileInput();
                });
            } else {
                setupBasicMenuFileInput();
            }
        }
        
        // 设置基本菜单文件输入事件
        function setupBasicMenuFileInput() {
            const basicMenuFileInput = document.getElementById('basicMenuFile');
            if (basicMenuFileInput) {
                basicMenuFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        loadBasicMenuFromExcel(file);
                        // 清空文件输入，以便可以重复选择同一个文件
                        e.target.value = '';
                    }
                });
            }
            
            // 添加周数选择器事件监听器
            const weekSelector = document.getElementById('weekSelector');
            if (weekSelector) {
                weekSelector.addEventListener('change', function() {
                    loadBasicMenu(this.value);
                });
            }
        }
        
        // 页面加载时初始化Excel上传功能
        initBasicMenuExcelUpload();
        
        // 保存基本菜单到服务器
        function saveBasicMenuToServer() {
            if (!currentExcelFile) {
                alert('请先导入Excel文件');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', currentExcelFile);
            
            // 显示加载状态
            const saveBtn = document.getElementById('saveToServerBtn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 保存中...';
            saveBtn.disabled = true;
            
            // 保存当前表格数据，以便保存成功后重新显示
            const currentWeekNumber = document.getElementById('weekSelector').value;
            
            // 发送文件到服务器
            fetch('/api/upload/excel', {
                method: 'POST',
                body: formData
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.message) {
                    alert('数据保存成功！');
                    // 重新加载服务器数据
                    loadBasicMenu(currentWeekNumber);
                    // 禁用保存按钮
                    document.getElementById('saveToServerBtn').disabled = true;
                    // 清空当前文件
                    currentExcelFile = null;
                    parsedBasicMenuData = null;
                } else if (data.error) {
                    alert('保存失败：' + data.error);
                }
            })
            .catch(function(error) {
                console.error('Error saving menu to server:', error);
                alert('保存失败，请重试');
            })
            .finally(function() {
                // 恢复按钮状态
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            });
        }

        // 导出基本菜单到Excel
        function exportBasicMenuToExcel() {
            const week = document.getElementById('weekSelector').value;
            
            // 如果有预览数据，导出预览数据
            if (parsedBasicMenuData && parsedBasicMenuData.length > 0) {
                exportDataToExcel(parsedBasicMenuData, week);
                return;
            }
            
            // 否则从服务器获取数据
            fetch('/api/menus')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    if (data.length === 0) {
                        alert('暂无菜单数据');
                        return;
                    }
                    
                    // 根据周数查找对应的菜单
                    const menu = data.find(m => m.week_number == week);
                    if (!menu || !menu.dishes_by_day) {
                        alert('暂无第' + week + '周的菜单数据');
                        return;
                    }
                    
                    const mealTypes = ['早餐', '早加', '午餐', '午加', '晚餐', '晚加'];
                    const days = ['周六', '周日', '周一', '周二', '周三', '周四', '周五'];
                    
                    // 准备Excel数据
                    const excelData = [];
                    
                    // 添加表头
                    const header = ['餐别', ...days];
                    excelData.push(header);
                    
                    // 添加数据行
                    mealTypes.forEach(function(mealType) {
                        const row = [mealType];
                        
                        days.forEach(function(day) {
                            const dayIndex = days.indexOf(day) + 1;
                            
                            if (menu.dishes_by_day[dayIndex] && menu.dishes_by_day[dayIndex][mealType]) {
                                const dishes = menu.dishes_by_day[dayIndex][mealType];
                                const dishNames = dishes.map(function(dish) {
                                    return dish.name + (dish.restrictions ? `(${dish.restrictions})` : '');
                                }).join('\n');
                                row.push(dishNames);
                            } else {
                                row.push('-');
                            }
                        });
                        
                        excelData.push(row);
                    });
                    
                    // 创建工作簿和工作表
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.aoa_to_sheet(excelData);
                    
                    // 设置列宽
                    const wscols = [
                        {wch: 10},  // 餐别
                        {wch: 20},  // 周六
                        {wch: 20},  // 周日
                        {wch: 20},  // 周一
                        {wch: 20},  // 周二
                        {wch: 20},  // 周三
                        {wch: 20},  // 周四
                        {wch: 20}   // 周五
                    ];
                    ws['!cols'] = wscols;
                    
                    // 添加工作表到工作簿
                    XLSX.utils.book_append_sheet(wb, ws, `第${week}周菜单`);
                    
                    // 导出Excel文件
                    const fileName = `基本菜单_第${week}周_${new Date().toISOString().split('T')[0]}.xlsx`;
                    XLSX.writeFile(wb, fileName);
                })
                .catch(function(error) {
                    console.error('Error exporting menu to Excel:', error);
                    alert('导出Excel失败');
                });
        }
        
        // 导出数据到Excel（用于预览数据）
        function exportDataToExcel(data, week) {
            const mealTypes = ['早餐', '早加', '午餐', '午加', '晚餐', '晚加'];
            const days = ['周六', '周日', '周一', '周二', '周三', '周四', '周五'];
            
            // 创建一个映射来存储菜品数据
            const menuData = {};
            
            // 初始化菜单数据结构
            mealTypes.forEach(mealType => {
                menuData[mealType] = {};
                days.forEach(day => {
                    menuData[mealType][day] = [];
                });
            });
            
            // 简化Excel解析逻辑（与populateBasicMenuTable保持一致）
            // 首先找到星期行
            let weekRowIndex = -1;
            data.forEach((row, index) => {
                const keys = Object.keys(row);
                if (keys.some(key => {
                    const value = row[key];
                    return value && value.toString().includes('周六');
                })) {
                    weekRowIndex = index;
                }
            });
            
            if (weekRowIndex >= 0) {
                // 获取星期对应的列索引
                const dayMap = {};
                const weekRow = data[weekRowIndex];
                const keys = Object.keys(weekRow);
                
                keys.forEach(key => {
                    const value = weekRow[key];
                    if (value) {
                        const dayValue = value.toString().trim();
                        if (days.includes(dayValue)) {
                            dayMap[dayValue] = key;
                        }
                    }
                });
                
                // 从餐别行开始处理数据
                let currentMealType = null;
                
                for (let i = weekRowIndex + 1; i < data.length; i++) {
                    const row = data[i];
                    const firstCell = row[keys[0]];
                    
                    if (firstCell) {
                        const cellValue = firstCell.toString().trim();
                        
                        if (mealTypes.includes(cellValue)) {
                            // 找到新的餐别
                            currentMealType = cellValue;
                        } else if (currentMealType) {
                            // 处理当前餐别的菜品数据
                            days.forEach(day => {
                                const dayKey = dayMap[day];
                                if (dayKey) {
                                    const dishName = row[dayKey];
                                    if (dishName) {
                                        const dishValue = dishName.toString().trim();
                                        if (dishValue !== '' && dishValue !== '-') {
                                            menuData[currentMealType][day].push({ name: dishValue });
                                        }
                                    }
                                }
                            });
                        }
                    }
                }
            }
            
            // 准备Excel数据
            const excelData = [];
            
            // 添加表头
            const header = ['餐别', ...days];
            excelData.push(header);
            
            // 添加数据行
            mealTypes.forEach(function(mealType) {
                const row = [mealType];
                
                days.forEach(function(day) {
                    const dishes = menuData[mealType][day];
                    if (dishes && dishes.length > 0) {
                        const dishNames = dishes.map(function(dish) {
                            return dish.name + (dish.restrictions ? `(${dish.restrictions})` : '');
                        }).join('\n');
                        row.push(dishNames);
                    } else {
                        row.push('-');
                    }
                });
                
                excelData.push(row);
            });
            
            // 创建工作簿和工作表
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(excelData);
            
            // 设置列宽
            const wscols = [
                {wch: 10},  // 餐别
                {wch: 20},  // 周六
                {wch: 20},  // 周日
                {wch: 20},  // 周一
                {wch: 20},  // 周二
                {wch: 20},  // 周三
                {wch: 20},  // 周四
                {wch: 20}   // 周五
            ];
            ws['!cols'] = wscols;
            
            // 添加工作表到工作簿
            XLSX.utils.book_append_sheet(wb, ws, `第${week}周菜单`);
            
            // 导出Excel文件
            const fileName = `基本菜单_第${week}周_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        function selectMenu(menuId) {
            fetch(`/api/menus/${menuId}`)
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    document.getElementById('noMenuSelected').style.display = 'none';
                    document.getElementById('menuDetailPanel').style.display = 'block';
                    
                    document.getElementById('menuName').value = data.name;
                    document.getElementById('menuPrice').value = data.price || 0;
                    document.getElementById('menuFeatures').value = data.features || '';
                    document.getElementById('menuNutrition').value = data.nutrition || '';
                    document.getElementById('menuCalories').value = data.calories || 0;
                    document.getElementById('menuNutritionist').value = data.nutritionist || '';
                    document.getElementById('menuCreateTime').value = data.create_time || '';
                    
                    loadMenuDishes(menuId);
                    
                    const user = JSON.parse(localStorage.getItem('user'));
                    if (user.role === 'admin') {
                        document.getElementById('deleteMenuBtn').style.display = 'inline-block';
                    } else {
                        document.getElementById('deleteMenuBtn').style.display = 'none';
                    }
                    
                    document.querySelectorAll('#menuList .list-group-item').forEach(function(item) {
                        item.classList.remove('active');
                    });
                    document.querySelector(`#menuList [data-menu-id="${menuId}"]`).classList.add('active');
                })
                .catch(function(error) {
                    console.error('Error loading menu detail:', error);
                });
        }

        function loadMenuDishes(menuId) {
            fetch(`/api/menus/${menuId}`)
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    const selectedDishesList = document.getElementById('selectedDishesList');
                    selectedDishesList.innerHTML = '';
                    
                    let totalNutrition = '';
                    let totalCalories = 0;
                    
                    if (data.dishes_by_day) {
                        Object.keys(data.dishes_by_day).forEach(function(day) {
                            const dayNames = ['', '周一', '周二', '周三', '周四', '周五', '周六', '周日'];
                            const dayHeader = document.createElement('div');
                            dayHeader.className = 'mt-2 mb-1 fw-bold';
                            dayHeader.textContent = dayNames[day];
                            selectedDishesList.appendChild(dayHeader);
                            
                            Object.keys(data.dishes_by_day[day]).forEach(function(category) {
                                const categoryHeader = document.createElement('div');
                                categoryHeader.className = 'text-muted small';
                                categoryHeader.textContent = category;
                                selectedDishesList.appendChild(categoryHeader);
                                
                                data.dishes_by_day[day][category].forEach(function(dish) {
                                    const dishItem = document.createElement('div');
                                    dishItem.className = 'd-flex justify-content-between align-items-center p-2 border-bottom';
                                    dishItem.innerHTML = `
                                        <span>${dish.name}</span>
                                        <small class="text-muted">${dish.restrictions || ''}</small>
                                    `;
                                    selectedDishesList.appendChild(dishItem);
                                });
                            });
                        });
                    }
                    
                    loadAllDishes();
                })
                .catch(function(error) {
                    console.error('Error loading menu dishes:', error);
                });
        }

        function loadAllDishes() {
            fetch('/api/dishes')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    const allDishesList = document.getElementById('allDishesList');
                    allDishesList.innerHTML = '';
                    
                    data.forEach(function(dish) {
                        const dishItem = document.createElement('div');
                        dishItem.className = 'd-flex justify-content-between align-items-center p-2 border-bottom';
                        dishItem.draggable = true;
                        dishItem.innerHTML = `
                            <span>${dish.name}</span>
                            <small class="text-muted">${dish.restrictions || ''}</small>
                        `;
                        dishItem.dataset.dishId = dish.id;
                        dishItem.dataset.dishName = dish.name;
                        dishItem.dataset.dishNutrition = dish.ingredients || '';
                        dishItem.dataset.dishCalories = dish.calories || 0;
                        
                        dishItem.addEventListener('dragstart', function(e) {
                            e.dataTransfer.setData('text/plain', JSON.stringify({
                                id: dish.id,
                                name: dish.name,
                                nutrition: dish.ingredients || '',
                                calories: dish.calories || 0
                            }));
                        });
                        
                        allDishesList.appendChild(dishItem);
                    });
                })
                .catch(function(error) {
                    console.error('Error loading dishes:', error);
                });
        }

        function loadAllDishesForModal() {
            fetch('/api/dishes')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    const allDishesList = document.getElementById('addAllDishesList');
                    allDishesList.innerHTML = '';
                    
                    data.forEach(function(dish) {
                        const dishItem = document.createElement('div');
                        dishItem.className = 'd-flex justify-content-between align-items-center p-2 border-bottom';
                        dishItem.draggable = true;
                        dishItem.innerHTML = `
                            <span>${dish.name}</span>
                            <small class="text-muted">${dish.restrictions || ''}</small>
                        `;
                        dishItem.dataset.dishId = dish.id;
                        dishItem.dataset.dishName = dish.name;
                        dishItem.dataset.dishNutrition = dish.ingredients || '';
                        dishItem.dataset.dishCalories = dish.calories || 0;
                        
                        dishItem.addEventListener('dragstart', function(e) {
                            e.dataTransfer.setData('text/plain', JSON.stringify({
                                id: dish.id,
                                name: dish.name,
                                nutrition: dish.ingredients || '',
                                calories: dish.calories || 0
                            }));
                        });
                        
                        allDishesList.appendChild(dishItem);
                    });
                    
                    setupDropZone('addSelectedDishesList');
                })
                .catch(function(error) {
                    console.error('Error loading dishes:', error);
                });
        }

        function setupDropZone(dropZoneId) {
            const dropZone = document.getElementById(dropZoneId);
            if (!dropZone) return;
            
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                const dishData = JSON.parse(e.dataTransfer.getData('text/plain'));
                
                const dishItem = document.createElement('div');
                dishItem.className = 'd-flex justify-content-between align-items-center p-2 border-bottom';
                dishItem.innerHTML = `
                    <span>${dishData.name}</span>
                    <small class="text-muted">${dishData.nutrition || ''}</small>
                    <button class="btn btn-sm btn-danger ms-2" onclick="this.parentElement.remove()">删除</button>
                `;
                dishItem.dataset.dishId = dishData.id;
                dishItem.dataset.dishName = dishData.name;
                dishItem.dataset.dishNutrition = dishData.nutrition;
                dishItem.dataset.dishCalories = dishData.calories;
                
                dropZone.appendChild(dishItem);
                updateMenuTotals();
            });
        }

        function updateMenuTotals() {
            const selectedDishes = document.querySelectorAll('#selectedDishesList > div, #addSelectedDishesList > div');
            let totalCalories = 0;
            let allNutrition = [];
            
            selectedDishes.forEach(function(dishItem) {
                const calories = parseInt(dishItem.dataset.dishCalories) || 0;
                totalCalories += calories;
                
                const nutrition = dishItem.dataset.dishNutrition;
                if (nutrition) {
                    allNutrition.push(nutrition);
                }
            });
            
            const uniqueNutrition = [...new Set(allNutrition)].join(', ');
            
            const menuPrice = document.getElementById('menuPrice');
            const menuNutrition = document.getElementById('menuNutrition');
            const menuCalories = document.getElementById('menuCalories');
            
            if (menuPrice && !menuPrice.readOnly) {
                menuPrice.value = selectedDishes.length * 50;
            }
            
            if (menuNutrition && !menuNutrition.readOnly) {
                menuNutrition.value = uniqueNutrition;
            }
            
            if (menuCalories && !menuCalories.readOnly) {
                menuCalories.value = totalCalories;
            }
        }

        // 加载每日餐单数据
        function loadDailyMenus(date = '') {
            if (!date) {
                const today = new Date();
                date = today.toISOString().split('T')[0];
                document.getElementById('dateFilter').value = date;
            }
            
            let url = '/api/daily_menus';
            if (date) {
                url += `?date=${date}`;
            }
            
            fetch(url)
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    const dailyMenuContent = document.getElementById('dailyMenuContent');
                    const noRecordDiv = document.getElementById('noDailyMenuRecord');
                    
                    if (data.length === 0) {
                        dailyMenuContent.innerHTML = '';
                        noRecordDiv.style.display = 'block';
                        return;
                    }
                    
                    noRecordDiv.style.display = 'none';
                    const menu = data[0];
                    
                    let html = `
                        <div class="card">
                            <div class="card-body">
                                <h5>${menu.date} - ${menu.description}</h5>
                                <hr>
                    `;
                    
                    if (menu.customers && menu.customers.length > 0) {
                        html += '<div class="row">';
                        
                        menu.customers.forEach(function(customer) {
                            html += `
                                <div class="col-md-12 mb-3">
                                    <div class="card border-light">
                                        <div class="card-header bg-light">
                                            <h6 class="mb-0">${customer.name} <small class="text-muted">(${customer.restrictions || '无禁忌'})</small></h6>
                                        </div>
                                        <div class="card-body p-2">
                                            <div class="d-flex flex-wrap gap-2">
                                                <div><strong>早餐:</strong> ${customer.meals ? (customer.meals.breakfast || []).join(', ') : '无'}</div>
                                                <div><strong>早加:</strong> ${customer.meals ? (customer.meals.morning_snack || []).join(', ') : '无'}</div>
                                                <div><strong>午餐:</strong> ${customer.meals ? (customer.meals.lunch || []).join(', ') : '无'}</div>
                                                <div><strong>午加:</strong> ${customer.meals ? (customer.meals.afternoon_snack || []).join(', ') : '无'}</div>
                                                <div><strong>晚餐:</strong> ${customer.meals ? (customer.meals.dinner || []).join(', ') : '无'}</div>
                                                <div><strong>晚加:</strong> ${customer.meals ? (customer.meals.evening_snack || []).join(', ') : '无'}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += '</div>';
                    } else {
                        html += '<p class="text-center text-muted">暂无客户数据</p>';
                    }
                    
                    html += '</div></div>';
                    dailyMenuContent.innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error loading daily menus:', error);
                });
        }

        // 加载客户数据
        function loadCustomers() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (user.role === 'admin' || user.role === 'admin_staff' || user.role === 'head_nurse') {
                document.getElementById('addCustomerBtn').style.display = 'inline-block';
            }
        }

        function searchCustomer() {
            const customerName = document.getElementById('customerNameFilter').value.trim();
            if (!customerName) {
                alert('请输入客户姓名');
                return;
            }
            
            fetch(`/api/customers?name=${encodeURIComponent(customerName)}`)
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    const customerDetailContent = document.getElementById('customerDetailContent');
                    const noCustomerSelected = document.getElementById('noCustomerSelected');
                    
                    if (data.length === 0) {
                        customerDetailContent.style.display = 'none';
                        noCustomerSelected.style.display = 'block';
                        noCustomerSelected.textContent = '没有找到该客户';
                        return;
                    }
                    
                    const customer = data[0];
                    noCustomerSelected.style.display = 'none';
                    customerDetailContent.style.display = 'block';
                    
                    const user = JSON.parse(localStorage.getItem('user'));
                    if (user.role === 'admin' || user.role === 'admin_staff' || user.role === 'head_nurse') {
                        document.getElementById('editMotherBtn').style.display = 'inline-block';
                        document.getElementById('editChildBtn').style.display = 'inline-block';
                    } else {
                        document.getElementById('editMotherBtn').style.display = 'none';
                        document.getElementById('editChildBtn').style.display = 'none';
                    }
                    
                    document.getElementById('motherName').value = customer.name || '';
                    document.getElementById('motherAge').value = customer.age || '';
                    document.getElementById('motherPhone').value = customer.phone || '';
                    document.getElementById('motherCheckInDate').value = customer.check_in_date || '';
                    document.getElementById('motherCheckOutDate').value = customer.check_out_date || '';
                    document.getElementById('motherRestrictions').value = customer.restrictions || '';
                    document.getElementById('motherNotes').value = customer.notes || '';
                    
                    const childInfo = customer.child_info || {};
                    document.getElementById('childName').value = childInfo.name || '';
                    document.getElementById('childAge').value = childInfo.age || '';
                    document.getElementById('childGender').value = childInfo.gender || '';
                    document.getElementById('childBirthDate').value = childInfo.birth_date || '';
                    document.getElementById('childWeight').value = childInfo.weight || '';
                    document.getElementById('childHeight').value = childInfo.height || '';
                    document.getElementById('childAllergies').value = childInfo.allergies || '';
                    document.getElementById('childRestrictions').value = childInfo.restrictions || '';
                    document.getElementById('childSpecialNeeds').value = childInfo.special_needs || '';
                })
                .catch(function(error) {
                    console.error('Error searching customer:', error);
                });
        }

        // 编辑客户
        function editCustomer(customerId) {
            fetch(`/api/customers/${customerId}`)
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    // 填充表单数据
                    document.getElementById('customerId').value = data.id;
                    document.getElementById('customerName').value = data.name;
                    document.getElementById('customerRestrictions').value = data.restrictions || '';
                    document.getElementById('customerCheckInDate').value = data.check_in_date || '';
                    document.getElementById('customerCheckOutDate').value = data.check_out_date || '';
                    
                    // 填充妈妈详细信息
                    const motherInfo = data.mother_info || {};
                    document.getElementById('conceptionMethod').value = motherInfo.conception_method || '';
                    document.getElementById('pregnancyDiseases').value = motherInfo.pregnancy_diseases || '';
                    document.getElementById('fetalProtection').value = motherInfo.fetal_protection || '';
                    document.getElementById('surgeryHistory').value = motherInfo.surgery_history || '';
                    document.getElementById('geneticDiseases').value = motherInfo.genetic_diseases || '';
                    document.getElementById('bloodType').value = motherInfo.blood_type || '';
                    document.getElementById('bloodPressure').value = motherInfo.blood_pressure || '';
                    document.getElementById('weight').value = motherInfo.weight || '';
                    document.getElementById('temperature').value = motherInfo.temperature || '';
                    document.getElementById('pulse').value = motherInfo.pulse || '';
                    document.getElementById('prePregnancyWeight').value = motherInfo.pre_pregnancy_weight || '';
                    document.getElementById('productionHospital').value = motherInfo.production_hospital || '';
                    document.getElementById('productionDate').value = motherInfo.production_date || '';
                    
                    // 填充宝宝详细信息
                    const babyInfo = data.baby_info || {};
                    document.getElementById('babyName').value = babyInfo.name || '';
                    document.getElementById('babyGender').value = babyInfo.gender || '';
                    document.getElementById('babyBirthDate').value = babyInfo.birth_date || '';
                    document.getElementById('babyBirthWeight').value = babyInfo.birth_weight || '';
                    document.getElementById('babyBirthHeight').value = babyInfo.birth_height || '';
                    
                    // 显示模态框
                    const modal = new bootstrap.Modal(document.getElementById('customerEditModal'));
                    modal.show();
                })
                .catch(function(error) {
                    console.error('Error loading customer:', error);
                });
        }

        // 保存客户修改
        document.getElementById('saveCustomerChanges').addEventListener('click', function() {
            const customerId = document.getElementById('customerId').value;
            const customerName = document.getElementById('customerName').value;
            const customerRestrictions = document.getElementById('customerRestrictions').value;
            const customerCheckInDate = document.getElementById('customerCheckInDate').value;
            const customerCheckOutDate = document.getElementById('customerCheckOutDate').value;
            
            // 妈妈详细信息
            const conceptionMethod = document.getElementById('conceptionMethod').value;
            const pregnancyDiseases = document.getElementById('pregnancyDiseases').value;
            const fetalProtection = document.getElementById('fetalProtection').value;
            const surgeryHistory = document.getElementById('surgeryHistory').value;
            const geneticDiseases = document.getElementById('geneticDiseases').value;
            const bloodType = document.getElementById('bloodType').value;
            const bloodPressure = document.getElementById('bloodPressure').value;
            const weight = document.getElementById('weight').value;
            const temperature = document.getElementById('temperature').value;
            const pulse = document.getElementById('pulse').value;
            const prePregnancyWeight = document.getElementById('prePregnancyWeight').value;
            const productionHospital = document.getElementById('productionHospital').value;
            const productionDate = document.getElementById('productionDate').value;
            
            // 宝宝详细信息
            const babyName = document.getElementById('babyName').value;
            const babyGender = document.getElementById('babyGender').value;
            const babyBirthDate = document.getElementById('babyBirthDate').value;
            const babyBirthWeight = document.getElementById('babyBirthWeight').value;
            const babyBirthHeight = document.getElementById('babyBirthHeight').value;
            
            const customerData = {
                name: customerName,
                restrictions: customerRestrictions,
                check_in_date: customerCheckInDate,
                check_out_date: customerCheckOutDate,
                mother_info: {
                    conception_method: conceptionMethod,
                    pregnancy_diseases: pregnancyDiseases,
                    fetal_protection: fetalProtection,
                    surgery_history: surgeryHistory,
                    genetic_diseases: geneticDiseases,
                    blood_type: bloodType,
                    blood_pressure: bloodPressure,
                    weight: weight,
                    temperature: temperature,
                    pulse: pulse,
                    pre_pregnancy_weight: prePregnancyWeight,
                    production_hospital: productionHospital,
                    production_date: productionDate
                },
                baby_info: {
                    name: babyName,
                    gender: babyGender,
                    birth_date: babyBirthDate,
                    birth_weight: babyBirthWeight,
                    birth_height: babyBirthHeight
                }
            };
            
            fetch(`/api/customers/${customerId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(customerData)
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('customerEditModal'));
                modal.hide();
                
                // 刷新客户列表
                loadCustomers();
                
                // 显示成功消息
                const messageDiv = document.getElementById('uploadMessage');
                messageDiv.className = 'alert alert-success';
                messageDiv.textContent = '客户信息更新成功';
                messageDiv.style.display = 'block';
                
                // 3秒后隐藏消息
                setTimeout(function() {
                    messageDiv.style.display = 'none';
                }, 3000);
            })
            .catch(function(error) {
                console.error('Error updating customer:', error);
            });
        });

        // 加载菜品数据
        function loadDishes() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (user.role === 'admin' || user.role === 'nutritionist' || user.role === 'chef') {
                document.getElementById('addDishBtn').style.display = 'inline-block';
            }
            
            fetch('/api/dishes')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    const tbody = document.getElementById('dishesTableBody');
                    tbody.innerHTML = '';
                    
                    data.forEach(function(dish) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${dish.id}</td>
                            <td>${dish.name}</td>
                            <td>${dish.ingredients || '-'}</td>
                            <td>${dish.restrictions || '-'}</td>
                            <td>${dish.category || '-'}</td>
                            <td>${dish.price || '-'}</td>
                            <td>${dish.weight || '-'}</td>
                            <td>${dish.chef || '-'}</td>
                            <td>${dish.development_time || '-'}</td>
                            <td>
                                <button class="btn btn-sm btn-info" onclick="editDish(${dish.id})">编辑</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(function(error) {
                    console.error('Error loading dishes:', error);
                });
        }
        
        // 生成菜单报表
        function generateMenuReport() {
            const week = document.getElementById('menuReportWeek').value;
            const reportPreview = document.getElementById('reportPreview');
            
            reportPreview.innerHTML = '<div class="text-center py-4"><i class="fas fa-spinner fa-spin"></i> 正在生成报表...</div>';
            
            fetch('/api/menus')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    if (data.length === 0) {
                        reportPreview.innerHTML = '<p class="text-center text-muted">暂无菜单数据</p>';
                        return;
                    }
                    
                    const menu = data[0];
                    if (!menu || !menu.dishes_by_day) {
                        reportPreview.innerHTML = '<p class="text-center text-muted">暂无菜单数据</p>';
                        return;
                    }
                    
                    const mealTypes = ['早餐', '午餐', '晚餐', '早加', '午加', '晚加'];
                    const days = ['周六', '周日', '周一', '周二', '周三', '周四', '周五'];
                    
                    let html = `
                        <div class="print-container">
                            <div class="text-center mb-4">
                                <h2>上海巍阁公司 - 菜单报表</h2>
                                <h4>第 ${week} 周</h4>
                                <p class="text-muted">生成时间: ${new Date().toLocaleString()}</p>
                            </div>
                            <table class="table table-bordered table-striped">
                                <thead class="table-light">
                                    <tr>
                                        <th>餐别</th>
                                        <th>周六</th>
                                        <th>周日</th>
                                        <th>周一</th>
                                        <th>周二</th>
                                        <th>周三</th>
                                        <th>周四</th>
                                        <th>周五</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    mealTypes.forEach(function(mealType) {
                        html += `<tr>
                            <td class="fw-bold bg-light">${mealType}</td>`;
                        
                        days.forEach(function(day) {
                            const dayIndex = days.indexOf(day) + 1;
                            
                            if (menu.dishes_by_day[dayIndex] && menu.dishes_by_day[dayIndex][mealType]) {
                                const dishes = menu.dishes_by_day[dayIndex][mealType];
                                const dishNames = dishes.map(function(dish) {
                                    return dish.name + (dish.restrictions ? `(${dish.restrictions})` : '');
                                }).join('<br>');
                                html += `<td><div class="small">${dishNames}</div></td>`;
                            } else {
                                html += '<td><span class="text-muted">-</span></td>';
                            }
                        });
                        
                        html += `</tr>`;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    reportPreview.innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error generating menu report:', error);
                    reportPreview.innerHTML = '<p class="text-center text-danger">生成报表失败</p>';
                });
        }
        
        // 打印菜单报表
        function printMenuReport() {
            const reportPreview = document.getElementById('reportPreview');
            
            if (reportPreview.innerHTML.includes('请先生成报表查看预览') || 
                reportPreview.innerHTML.includes('暂无菜单数据') || 
                reportPreview.innerHTML.includes('生成报表失败')) {
                alert('请先生成菜单报表再进行打印');
                return;
            }
            
            const printContent = reportPreview.innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = `
                <html>
                <head>
                    <title>菜单报表打印</title>
                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
                    <style>
                        @media print {
                            body {
                                font-family: 'Microsoft YaHei', Arial, sans-serif;
                            }
                            table {
                                width: 100%;
                                border-collapse: collapse;
                            }
                            th, td {
                                border: 1px solid #ddd;
                                padding: 8px;
                                text-align: left;
                            }
                            th {
                                background-color: #f2f2f2;
                            }
                        }
                    </style>
                </head>
                <body>
                    ${printContent}
                </body>
                </html>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            window.location.reload();
        }
        
        // 导出菜单到Excel
        function exportMenuToExcel() {
            const week = document.getElementById('menuReportWeek').value;
            
            fetch('/api/menus')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    if (data.length === 0) {
                        alert('暂无菜单数据');
                        return;
                    }
                    
                    const menu = data[0];
                    if (!menu || !menu.dishes_by_day) {
                        alert('暂无菜单数据');
                        return;
                    }
                    
                    const mealTypes = ['早餐', '午餐', '晚餐', '早加', '午加', '晚加'];
                    const days = ['周六', '周日', '周一', '周二', '周三', '周四', '周五'];
                    
                    // 准备Excel数据
                    const excelData = [];
                    
                    // 添加表头
                    const header = ['餐别', ...days];
                    excelData.push(header);
                    
                    // 添加数据行
                    mealTypes.forEach(function(mealType) {
                        const row = [mealType];
                        
                        days.forEach(function(day) {
                            const dayIndex = days.indexOf(day) + 1;
                            
                            if (menu.dishes_by_day[dayIndex] && menu.dishes_by_day[dayIndex][mealType]) {
                                const dishes = menu.dishes_by_day[dayIndex][mealType];
                                const dishNames = dishes.map(function(dish) {
                                    return dish.name + (dish.restrictions ? `(${dish.restrictions})` : '');
                                }).join('\n');
                                row.push(dishNames);
                            } else {
                                row.push('-');
                            }
                        });
                        
                        excelData.push(row);
                    });
                    
                    // 创建工作簿和工作表
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.aoa_to_sheet(excelData);
                    
                    // 设置列宽
                    const wscols = [
                        {wch: 10},  // 餐别
                        {wch: 20},  // 周六
                        {wch: 20},  // 周日
                        {wch: 20},  // 周一
                        {wch: 20},  // 周二
                        {wch: 20},  // 周三
                        {wch: 20},  // 周四
                        {wch: 20}   // 周五
                    ];
                    ws['!cols'] = wscols;
                    
                    // 添加工作表到工作簿
                    XLSX.utils.book_append_sheet(wb, ws, `第${week}周菜单`);
                    
                    // 导出Excel文件
                    const fileName = `菜单报表_第${week}周_${new Date().toISOString().split('T')[0]}.xlsx`;
                    XLSX.writeFile(wb, fileName);
                })
                .catch(function(error) {
                    console.error('Error exporting menu to Excel:', error);
                    alert('导出Excel失败');
                });
        }
        
        function loadIngredients() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (user.role === 'admin' || user.role === 'nutritionist' || user.role === 'chef') {
                document.getElementById('addIngredientBtn').style.display = 'inline-block';
            }
            
            fetch('/api/ingredients')
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    const tbody = document.getElementById('ingredientsTableBody');
                    tbody.innerHTML = '';
                    
                    data.forEach(function(ingredient) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${ingredient.id}</td>
                            <td>${ingredient.name}</td>
                            <td>${ingredient.price || '-'}</td>
                            <td>${ingredient.weight || '-'}</td>
                            <td>${ingredient.supplier || '-'}</td>
                            <td>${ingredient.nutrition || '-'}</td>
                            <td>${ingredient.calories || '-'}</td>
                            <td>${ingredient.purchase_date || '-'}</td>
                            <td>${ingredient.expiry_date || '-'}</td>
                            <td>
                                <button class="btn btn-sm btn-info" onclick="editIngredient(${ingredient.id})">编辑</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(function(error) {
                    console.error('Error loading ingredients:', error);
                });
        }
        
        function loadDashboardData() {
            if (!currentUser) return;
            
            // 根据角色显示不同的统计卡片
            const infoCards = {
                'menu-count': document.querySelector('#menu-count').closest('.info-card'),
                'daily-menu-count': document.querySelector('#daily-menu-count').closest('.info-card'),
                'customer-count': document.querySelector('#customer-count').closest('.info-card'),
                'guest-count': document.querySelector('#guest-count').closest('.info-card')
            };
            
            // 角色对应的卡片权限
            const cardPermissions = {
                'admin': ['menu-count', 'daily-menu-count', 'customer-count', 'guest-count'],
                'nutritionist': ['menu-count', 'daily-menu-count', 'customer-count'],
                'chef': ['daily-menu-count'],
                'admin_staff': ['daily-menu-count', 'customer-count', 'guest-count'],
                'head_nurse': ['daily-menu-count', 'customer-count'],
                'nurse': ['daily-menu-count', 'customer-count'],
                'caregiver': ['daily-menu-count', 'customer-count'],
                'customer': ['daily-menu-count'],
                'guest': ['daily-menu-count']
            };
            
            const permissions = cardPermissions[currentUser.role] || ['daily-menu-count'];
            
            Object.keys(infoCards).forEach(key => {
                if (infoCards[key]) {
                    if (permissions.includes(key)) {
                        infoCards[key].style.display = 'block';
                    } else {
                        infoCards[key].style.display = 'none';
                    }
                }
            });
            
            Promise.all([
                fetch('/api/menus').then(r => r.json()),
                fetch('/api/daily_menus').then(r => r.json()),
                fetch('/api/customers').then(r => r.json())
            ])
            .then(function([menus, dailyMenus, customers]) {
                if (permissions.includes('menu-count')) {
                    document.getElementById('menu-count').textContent = menus.length;
                }
                if (permissions.includes('daily-menu-count')) {
                    document.getElementById('daily-menu-count').textContent = dailyMenus.length;
                }
                if (permissions.includes('customer-count')) {
                    document.getElementById('customer-count').textContent = customers.length;
                }
                if (permissions.includes('guest-count')) {
                    const activeGuests = customers.filter(function(customer) {
                        const today = new Date();
                        const checkInDate = customer.check_in_date ? new Date(customer.check_in_date) : null;
                        const checkOutDate = customer.check_out_date ? new Date(customer.check_out_date) : null;
                        return checkInDate && checkInDate <= today && (!checkOutDate || checkOutDate >= today);
                    });
                    document.getElementById('guest-count').textContent = activeGuests.length;
                }
            })
            .catch(function(error) {
                console.error('Error loading dashboard data:', error);
            });
            
            loadScheduleList();
            loadNotificationList();
        }
        
        function loadScheduleList() {
            if (!currentUser) return;
            
            const scheduleList = document.getElementById('schedule-list');
            scheduleList.innerHTML = '';
            
            // 根据角色显示不同的日程
            const roleSchedules = {
                'admin': [
                    { date: '2026-01-31', title: '客户张三入住', type: 'info' },
                    { date: '2026-02-01', title: '客户李四退房', type: 'warning' },
                    { date: '2026-02-02', title: '营养师王五审核菜单', type: 'success' },
                    { date: '2026-02-03', title: '新菜品试吃活动', type: 'primary' }
                ],
                'nutritionist': [
                    { date: '2026-01-31', title: '审核今日菜单', type: 'warning' },
                    { date: '2026-02-02', title: '制定下周菜单', type: 'primary' },
                    { date: '2026-02-03', title: '新菜品试吃活动', type: 'success' }
                ],
                'chef': [
                    { date: '2026-01-31', title: '准备今日食材', type: 'info' },
                    { date: '2026-02-03', title: '新菜品试吃活动', type: 'success' }
                ],
                'admin_staff': [
                    { date: '2026-01-31', title: '客户张三入住', type: 'info' },
                    { date: '2026-02-01', title: '客户李四退房', type: 'warning' },
                    { date: '2026-02-02', title: '月度财务报表', type: 'primary' }
                ],
                'head_nurse': [
                    { date: '2026-01-31', title: '客户张三入住', type: 'info' },
                    { date: '2026-02-01', title: '客户李四退房', type: 'warning' },
                    { date: '2026-02-02', title: '护理人员排班', type: 'primary' }
                ],
                'nurse': [
                    { date: '2026-01-31', title: '客户张三入住', type: 'info' },
                    { date: '2026-02-01', title: '客户李四退房', type: 'warning' }
                ],
                'caregiver': [
                    { date: '2026-01-31', title: '客户张三入住', type: 'info' },
                    { date: '2026-02-01', title: '客户李四退房', type: 'warning' }
                ],
                'customer': [
                    { date: '2026-01-31', title: '今日餐单提醒', type: 'info' },
                    { date: '2026-02-01', title: '营养咨询预约', type: 'primary' }
                ],
                'guest': [
                    { date: '2026-01-31', title: '欢迎使用巍阁系统', type: 'info' },
                    { date: '2026-02-01', title: '今日餐单提醒', type: 'primary' }
                ]
            };
            
            const schedules = roleSchedules[currentUser.role] || [];
            
            schedules.forEach(function(schedule) {
                const item = document.createElement('div');
                item.className = 'd-flex justify-content-between align-items-center p-2 border-bottom';
                item.innerHTML = `
                    <div>
                        <strong>${schedule.date}</strong>
                        <span class="ms-2">${schedule.title}</span>
                    </div>
                    <span class="badge bg-${schedule.type}">${schedule.type === 'info' ? '信息' : schedule.type === 'warning' ? '提醒' : schedule.type === 'success' ? '审核' : '活动'}</span>
                `;
                scheduleList.appendChild(item);
            });
        }
        
        function loadNotificationList() {
            if (!currentUser) return;
            
            const notificationList = document.getElementById('notification-list');
            notificationList.innerHTML = '';
            
            // 根据角色显示不同的通知
            const roleNotifications = {
                'admin': [
                    { message: '欢迎使用上海巍阁公司管理系统', time: '2026-01-30 10:00', type: 'info' },
                    { message: '数据上传成功', time: '2026-01-30 14:30', type: 'success' },
                    { message: '有3条待审核记录', time: '2026-01-30 16:00', type: 'warning' },
                    { message: '系统将于今晚进行维护', time: '2026-01-30 18:00', type: 'danger' }
                ],
                'nutritionist': [
                    { message: '欢迎使用上海巍阁公司管理系统', time: '2026-01-30 10:00', type: 'info' },
                    { message: '新菜单已创建', time: '2026-01-30 14:30', type: 'success' },
                    { message: '有2条菜单待审核', time: '2026-01-30 16:00', type: 'warning' }
                ],
                'chef': [
                    { message: '欢迎使用上海巍阁公司管理系统', time: '2026-01-30 10:00', type: 'info' },
                    { message: '今日餐单已更新', time: '2026-01-30 14:30', type: 'success' },
                    { message: '部分食材库存不足', time: '2026-01-30 16:00', type: 'warning' }
                ],
                'admin_staff': [
                    { message: '欢迎使用上海巍阁公司管理系统', time: '2026-01-30 10:00', type: 'info' },
                    { message: '客户张三已入住', time: '2026-01-30 14:30', type: 'success' },
                    { message: '月度财务报表已生成', time: '2026-01-30 16:00', type: 'primary' }
                ],
                'head_nurse': [
                    { message: '欢迎使用上海巍阁公司管理系统', time: '2026-01-30 10:00', type: 'info' },
                    { message: '客户张三已入住', time: '2026-01-30 14:30', type: 'success' },
                    { message: '护理人员排班已更新', time: '2026-01-30 16:00', type: 'primary' }
                ],
                'nurse': [
                    { message: '欢迎使用上海巍阁公司管理系统', time: '2026-01-30 10:00', type: 'info' },
                    { message: '客户张三已入住', time: '2026-01-30 14:30', type: 'success' }
                ],
                'caregiver': [
                    { message: '欢迎使用上海巍阁公司管理系统', time: '2026-01-30 10:00', type: 'info' },
                    { message: '客户张三已入住', time: '2026-01-30 14:30', type: 'success' }
                ],
                'customer': [
                    { message: '欢迎使用上海巍阁公司管理系统', time: '2026-01-30 10:00', type: 'info' },
                    { message: '今日餐单已更新', time: '2026-01-30 14:30', type: 'success' },
                    { message: '营养咨询预约成功', time: '2026-01-30 16:00', type: 'primary' }
                ],
                'guest': [
                    { message: '欢迎使用上海巍阁公司管理系统', time: '2026-01-30 10:00', type: 'info' },
                    { message: '今日餐单已更新', time: '2026-01-30 14:30', type: 'success' }
                ]
            };
            
            const notifications = roleNotifications[currentUser.role] || [];
            
            notifications.forEach(function(notification) {
                const item = document.createElement('div');
                item.className = 'd-flex justify-content-between align-items-center p-2 border-bottom';
                item.innerHTML = `
                    <div>
                        <span class="badge bg-${notification.type} me-2">${notification.type === 'info' ? '通知' : notification.type === 'success' ? '成功' : notification.type === 'warning' ? '待办' : '警告'}</span>
                        <span>${notification.message}</span>
                    </div>
                    <small class="text-muted">${notification.time}</small>
                `;
                notificationList.appendChild(item);
            });
        }
        
        // 添加食材
        document.getElementById('addIngredientBtn').addEventListener('click', function() {
            document.getElementById('ingredientId').value = '';
            document.getElementById('ingredientEditForm').reset();
            const modal = new bootstrap.Modal(document.getElementById('ingredientEditModal'));
            modal.show();
        });
        
        // 编辑食材
        function editIngredient(ingredientId) {
            fetch(`/api/ingredients/${ingredientId}`)
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    document.getElementById('ingredientId').value = data.id;
                    document.getElementById('ingredientName').value = data.name;
                    document.getElementById('ingredientWeight').value = data.weight || '';
                    document.getElementById('ingredientPrice').value = data.price || '';
                    document.getElementById('ingredientRestrictions').value = data.restrictions || '';
                    document.getElementById('ingredientSupplier').value = data.supplier || '';
                    document.getElementById('ingredientNutrition').value = data.nutrition || '';
                    document.getElementById('ingredientCalories').value = data.calories || '';
                    document.getElementById('ingredientPurchaseDate').value = data.purchase_date || '';
                    document.getElementById('ingredientProcessingDate').value = data.processing_date || '';
                    document.getElementById('ingredientShelfLife').value = data.shelf_life || '';
                    
                    const modal = new bootstrap.Modal(document.getElementById('ingredientEditModal'));
                    modal.show();
                })
                .catch(function(error) {
                    console.error('Error loading ingredient:', error);
                });
        }
        
        // 保存食材修改
        document.getElementById('saveIngredientChanges').addEventListener('click', function() {
            const ingredientId = document.getElementById('ingredientId').value;
            const ingredientName = document.getElementById('ingredientName').value;
            const ingredientWeight = document.getElementById('ingredientWeight').value;
            const ingredientPrice = document.getElementById('ingredientPrice').value;
            const ingredientRestrictions = document.getElementById('ingredientRestrictions').value;
            const ingredientSupplier = document.getElementById('ingredientSupplier').value;
            const ingredientNutrition = document.getElementById('ingredientNutrition').value;
            const ingredientCalories = document.getElementById('ingredientCalories').value;
            const ingredientPurchaseDate = document.getElementById('ingredientPurchaseDate').value;
            const ingredientProcessingDate = document.getElementById('ingredientProcessingDate').value;
            const ingredientShelfLife = document.getElementById('ingredientShelfLife').value;
            
            const ingredientData = {
                name: ingredientName,
                weight: ingredientWeight,
                price: ingredientPrice,
                restrictions: ingredientRestrictions,
                supplier: ingredientSupplier,
                nutrition: ingredientNutrition,
                calories: ingredientCalories,
                purchase_date: ingredientPurchaseDate,
                processing_date: ingredientProcessingDate,
                shelf_life: ingredientShelfLife
            };
            
            let url = '/api/ingredients';
            let method = 'POST';
            
            if (ingredientId) {
                url += `/${ingredientId}`;
                method = 'PUT';
            }
            
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(ingredientData)
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('ingredientEditModal'));
                modal.hide();
                
                // 刷新食材列表
                loadIngredients();
                
                // 显示成功消息
                const messageDiv = document.getElementById('uploadMessage');
                messageDiv.className = 'alert alert-success';
                messageDiv.textContent = ingredientId ? '食材信息更新成功' : '食材添加成功';
                messageDiv.style.display = 'block';
                
                // 3秒后隐藏消息
                setTimeout(function() {
                    messageDiv.style.display = 'none';
                }, 3000);
            })
            .catch(function(error) {
                console.error('Error updating ingredient:', error);
            });
        });

        // 编辑菜品
        function editDish(dishId) {
            fetch(`/api/dishes/${dishId}`)
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                // 填充表单数据
                document.getElementById('dishId').value = data.id;
                document.getElementById('dishName').value = data.name;
                document.getElementById('dishIngredients').value = data.ingredients || '';
                document.getElementById('dishRestrictions').value = data.restrictions || '';
                document.getElementById('dishCategory').value = data.category_id || 1;
                
                // 显示模态框
                const modal = new bootstrap.Modal(document.getElementById('dishEditModal'));
                modal.show();
            })
            .catch(function(error) {
                console.error('Error loading dish:', error);
            });
        }

        // 保存菜品修改
        document.getElementById('saveDishChanges').addEventListener('click', function() {
            const dishId = document.getElementById('dishId').value;
            const dishName = document.getElementById('dishName').value;
            const dishIngredients = document.getElementById('dishIngredients').value;
            const dishRestrictions = document.getElementById('dishRestrictions').value;
            const dishCategory = document.getElementById('dishCategory').value;
            
            const dishData = {
                name: dishName,
                ingredients: dishIngredients,
                restrictions: dishRestrictions,
                category_id: parseInt(dishCategory)
            };
            
            fetch(`/api/dishes/${dishId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dishData)
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                // 关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('dishEditModal'));
                modal.hide();
                
                // 刷新菜品列表
                loadDishes();
                
                // 显示成功消息
                const messageDiv = document.getElementById('uploadMessage');
                messageDiv.className = 'alert alert-success';
                messageDiv.textContent = '菜品信息更新成功';
                messageDiv.style.display = 'block';
                
                // 3秒后隐藏消息
                setTimeout(function() {
                    messageDiv.style.display = 'none';
                }, 3000);
            })
            .catch(function(error) {
                console.error('Error updating dish:', error);
            });
        });

        // 查看菜单详情
        function viewMenuDetail(menuId) {
            fetch(`/api/menus/${menuId}`)
                .then(response => response.json())
                .then(data => {
                    const modalBody = document.getElementById('menuDetailBody');
                    let html = `
                        <h4>${data.name}</h4>
                        <p>${data.description}</p>
                        <hr>
                    `;
                    
                    // 显示每天的菜品
                    for (let day in data.dishes_by_day) {
                        const dayNames = ['', '周一', '周二', '周三', '周四', '周五', '周六', '周日'];
                        html += `<h5>${dayNames[day]}</h5>`;
                        
                        for (let category in data.dishes_by_day[day]) {
                            html += `<h6>${category}</h6>`;
                            html += '<div class="row">';
                            
                            // 按类型分组显示：饮料、主食、菜品
                            const dishTypes = {
                                '饮料': [],
                                '主食': [],
                                '菜品': []
                            };
                            
                            data.dishes_by_day[day][category].forEach(dish => {
                                // 根据菜品名称判断类型，实际项目中应从后端获取类型
                                if (dish.name.includes('汤') || dish.name.includes('汁') || dish.name.includes('糊') || dish.name.includes('茶')) {
                                    dishTypes['饮料'].push(dish);
                                } else if (dish.name.includes('饭') || dish.name.includes('面') || dish.name.includes('粥') || dish.name.includes('饺')) {
                                    dishTypes['主食'].push(dish);
                                } else {
                                    dishTypes['菜品'].push(dish);
                                }
                            });
                            
                            // 显示各类别菜品
                            for (let type in dishTypes) {
                                if (dishTypes[type].length > 0) {
                                    html += `<div class="col-md-4">
                                        <h7 class="font-weight-bold">${type}:</h7>
                                        <ul class="list-unstyled">`;
                                    dishTypes[type].forEach(dish => {
                                        html += `<li>${dish.name}`;
                                        if (dish.restrictions) {
                                            html += ` (${dish.restrictions})`;
                                        }
                                        html += '</li>';
                                    });
                                    html += `</ul>
                                    </div>`;
                                }
                            }
                            
                            html += '</div>';
                        }
                    }
                    
                    modalBody.innerHTML = html;
                    
                    // 显示模态框
                    const modal = new bootstrap.Modal(document.getElementById('menuDetailModal'));
                    modal.show();
                })
                .catch(error => console.error('Error loading menu detail:', error));
        }

        // 查看每日餐单详情
        function viewDailyMenuDetail(menuId) {
            fetch(`/api/daily_menus/${menuId}`)
                .then(response => response.json())
                .then(data => {
                    const modalBody = document.getElementById('menuDetailBody');
                    let html = `
                        <h4>${data.date} - ${data.description}</h4>
                        <hr>
                    `;
                    
                    // 显示客户餐食安排统计
                    if (data.customers && data.customers.length > 0) {
                        html += '<h5>客户餐食安排</h5>';
                        data.customers.forEach(customer => {
                            html += `<div class="card mt-3">
                                <div class="card-header">
                                    ${customer.name}
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>禁忌:</strong> ${customer.restrictions || '无'}</p>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <h6>早餐:</h6>
                                        <ul class="list-unstyled">
                                            ${(customer.meals && customer.meals.breakfast ? customer.meals.breakfast.map(dish => `<li>${dish}</li>`).join('') : '无')}
                                        </ul>
                                    </div>
                                    <div class="mt-2">
                                        <h6>早加餐:</h6>
                                        <ul class="list-unstyled">
                                            ${(customer.meals && customer.meals.morning_snack ? customer.meals.morning_snack.map(dish => `<li>${dish}</li>`).join('') : '无')}
                                        </ul>
                                    </div>
                                    <div class="mt-2">
                                        <h6>午餐:</h6>
                                        <ul class="list-unstyled">
                                            ${(customer.meals && customer.meals.lunch ? customer.meals.lunch.map(dish => `<li>${dish}</li>`).join('') : '无')}
                                        </ul>
                                    </div>
                                    <div class="mt-2">
                                        <h6>午加餐:</h6>
                                        <ul class="list-unstyled">
                                            ${(customer.meals && customer.meals.afternoon_snack ? customer.meals.afternoon_snack.map(dish => `<li>${dish}</li>`).join('') : '无')}
                                        </ul>
                                    </div>
                                    <div class="mt-2">
                                        <h6>晚餐:</h6>
                                        <ul class="list-unstyled">
                                            ${(customer.meals && customer.meals.dinner ? customer.meals.dinner.map(dish => `<li>${dish}</li>`).join('') : '无')}
                                        </ul>
                                    </div>
                                    <div class="mt-2">
                                        <h6>晚加餐:</h6>
                                        <ul class="list-unstyled">
                                            ${(customer.meals && customer.meals.evening_snack ? customer.meals.evening_snack.map(dish => `<li>${dish}</li>`).join('') : '无')}
                                        </ul>
                                    </div>
                                </div>
                            </div>`;
                        });
                    }
                    
                    modalBody.innerHTML = html;
                    
                    // 显示模态框
                    const modal = new bootstrap.Modal(document.getElementById('menuDetailModal'));
                    modal.show();
                })
                .catch(error => console.error('Error loading daily menu detail:', error));
        }

        // 登录功能
        document.getElementById('loginButton').addEventListener('click', function() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const messageDiv = document.getElementById('loginMessage');
            
            if (!username || !password) {
                messageDiv.className = 'alert alert-danger';
                messageDiv.textContent = '用户名和密码不能为空';
                messageDiv.style.display = 'block';
                return;
            }
            
            fetch('/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.access_token) {
                    // 保存 token 到 localStorage
                    localStorage.setItem('token', data.access_token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    messageDiv.className = 'alert alert-success';
                    messageDiv.textContent = '登录成功';
                    messageDiv.style.display = 'block';
                    
                    // 3秒后关闭模态框并刷新页面
                    setTimeout(() => {
                        const modal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                        modal.hide();
                        location.reload();
                    }, 1500);
                } else {
                    messageDiv.className = 'alert alert-danger';
                    messageDiv.textContent = '输入的用户名密码错误！';
                    messageDiv.style.display = 'block';
                }
            })
            .catch(error => {
                messageDiv.className = 'alert alert-danger';
                messageDiv.textContent = '登录失败，请稍后重试';
                messageDiv.style.display = 'block';
                console.error('Login error:', error);
            });
        });

        // 注册功能
        document.getElementById('registerButton').addEventListener('click', function() {
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const role = 'user'; // 默认角色为粉丝
            const messageDiv = document.getElementById('registerMessage');
            
            if (!username || !password) {
                messageDiv.className = 'alert alert-danger';
                messageDiv.textContent = '用户名和密码不能为空';
                messageDiv.style.display = 'block';
                return;
            }
            
            fetch('/api/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password, role })
            })
            .then(response => response.json())
            .then(data => {
                if (data.user_id) {
                    messageDiv.className = 'alert alert-success';
                    messageDiv.textContent = '注册成功，请登录';
                    messageDiv.style.display = 'block';
                    
                    // 3秒后关闭注册模态框并打开登录模态框
                    setTimeout(() => {
                        const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                        registerModal.hide();
                        
                        // 清空注册表单
                        document.getElementById('registerForm').reset();
                        
                        // 打开登录模态框
                        const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                        loginModal.show();
                    }, 1500);
                } else {
                    messageDiv.className = 'alert alert-danger';
                    messageDiv.textContent = data.error || '注册失败';
                    messageDiv.style.display = 'block';
                }
            })
            .catch(error => {
                messageDiv.className = 'alert alert-danger';
                messageDiv.textContent = '注册失败，请稍后重试';
                messageDiv.style.display = 'block';
                console.error('Register error:', error);
            });
        });

        // 全局变量存储当前用户信息
        let currentUser = null;
        
        // 检查用户是否已登录
        function checkLoginStatus() {
            const token = localStorage.getItem('token');
            if (token) {
                currentUser = JSON.parse(localStorage.getItem('user'));
                const navLinks = document.querySelector('.navbar-nav.ms-auto');
                navLinks.innerHTML = `
                    <li class="nav-item">
                        <span class="nav-link">欢迎，${currentUser.username}</span>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-light" onclick="logout()">退出登录</button>
                    </li>
                `;
                
                document.getElementById('guest-content').style.display = 'none';
                document.getElementById('user-content').style.display = 'block';
                
                const navbar = document.querySelector('.navbar');
                const mainContent = document.querySelector('.container');
                
                // 移除所有主题类
                navbar.classList.remove('theme-blue', 'theme-green', 'theme-pink');
                mainContent.classList.remove('theme-blue', 'theme-green', 'theme-pink');
                
                // 定义角色权限
                const rolePermissions = {
                    'admin': ['menus', 'daily-menus', 'customers', 'dishes', 'employees', 'finance', 'reports'],
                    'nutritionist': ['menus', 'daily-menus', 'customers', 'dishes'],
                    'chef': ['daily-menus', 'dishes'],
                    'admin_staff': ['daily-menus', 'customers', 'employees', 'finance'],
                    'head_nurse': ['daily-menus', 'customers'],
                    'nurse': ['daily-menus', 'customers'],
                    'caregiver': ['daily-menus', 'customers'],
                    'customer': ['daily-menus'],
                    'guest': ['daily-menus']
                };
                
                const navItems = {
                    // 主菜单项
                    'confinementDropdown': document.getElementById('confinementDropdown'),
                    'customers': document.querySelector('a[href="#customers"]'),
                    'financeDropdown': document.getElementById('financeDropdown'),
                    'employeeDropdown': document.getElementById('employeeDropdown'),
                    'systemDropdown': document.getElementById('systemDropdown'),
                    'helpDropdown': document.getElementById('helpDropdown'),
                    
                    // 子菜单项
                    'menus': document.querySelector('a[href="#menus"]'),
                    'daily-menus': document.querySelector('a[href="#daily-menus"]'),
                    'dishes': document.querySelector('a[href="#dishes"]'),
                    'ingredients': document.querySelector('a[href="#ingredients"]'),
                    'packages': document.querySelector('a[href="#packages"]'),
                    'customer-orders': document.querySelector('a[href="#customer-orders"]'),
                    'cost-calculation': document.querySelector('a[href="#cost-calculation"]'),
                    'budget-management': document.querySelector('a[href="#budget-management"]'),
                    'financial-reports': document.querySelector('a[href="#financial-reports"]'),
                    'employees': document.querySelector('a[href="#employees"]'),
                    'permissions': document.querySelector('a[href="#permissions"]'),
                    'attendance': document.querySelector('a[href="#attendance"]'),
                    'reports': document.querySelector('a[href="#reports"]'),
                    'system-config': document.querySelector('a[href="#system-config"]'),
                    'data-backup': document.querySelector('a[href="#data-backup"]'),
                    'user-guide': document.querySelector('a[href="#user-guide"]'),
                    'faq': document.querySelector('a[href="#faq"]'),
                    'contact-us': document.querySelector('a[href="#contact-us"]'),
                    'about': document.querySelector('a[href="#about"]')
                };
                
                const permissions = rolePermissions[currentUser.role] || ['daily-menus'];
                
                // 检查是否有权限访问月子餐管理下拉菜单
                const hasConfinementAccess = ['menus', 'daily-menus', 'dishes'].some(p => permissions.includes(p));
                if (navItems.confinementDropdown) {
                    navItems.confinementDropdown.style.display = hasConfinementAccess ? 'block' : 'none';
                }
                
                // 检查是否有权限访问客户管理
                if (navItems.customers) {
                    navItems.customers.style.display = permissions.includes('customers') ? 'block' : 'none';
                }
                
                // 检查是否有权限访问财务管理下拉菜单
                const hasFinanceAccess = ['finance'].some(p => permissions.includes(p));
                if (navItems.financeDropdown) {
                    navItems.financeDropdown.style.display = hasFinanceAccess ? 'block' : 'none';
                }
                
                // 检查是否有权限访问员工管理下拉菜单
                const hasEmployeeAccess = ['employees'].some(p => permissions.includes(p));
                if (navItems.employeeDropdown) {
                    navItems.employeeDropdown.style.display = hasEmployeeAccess ? 'block' : 'none';
                }
                
                // 检查是否有权限访问系统管理下拉菜单
                const hasSystemAccess = ['reports'].some(p => permissions.includes(p));
                if (navItems.systemDropdown) {
                    navItems.systemDropdown.style.display = hasSystemAccess ? 'block' : 'none';
                }
                
                // 帮助菜单对所有用户可见
                if (navItems.helpDropdown) {
                    navItems.helpDropdown.style.display = 'block';
                }
                
                // 对外网未注册用户(guest)隐藏特定菜单项
                if (currentUser.role === 'guest') {
                    // 隐藏客户管理
                    if (navItems.customers) {
                        navItems.customers.style.display = 'none';
                    }
                    // 隐藏财务管理
                    if (navItems.financeDropdown) {
                        navItems.financeDropdown.style.display = 'none';
                    }
                    // 隐藏员工管理
                    if (navItems.employeeDropdown) {
                        navItems.employeeDropdown.style.display = 'none';
                    }
                    // 隐藏系统管理
                    if (navItems.systemDropdown) {
                        navItems.systemDropdown.style.display = 'none';
                    }
                }
                
                // 检查子菜单项权限
                // 基础菜单项权限
                ['menus', 'daily-menus', 'dishes', 'employees', 'finance', 'reports'].forEach(key => {
                    const item = navItems[key];
                    if (item) {
                        item.style.display = permissions.includes(key) ? 'block' : 'none';
                    }
                });
                
                // 新添加的子菜单项权限
                // 食材管理: 与菜品管理权限相同
                if (navItems.ingredients) {
                    navItems.ingredients.style.display = ['admin', 'nutritionist', 'chef'].includes(currentUser.role) ? 'block' : 'none';
                }
                
                // 套餐定制: 与菜单管理权限相同
                if (navItems.packages) {
                    navItems.packages.style.display = ['admin', 'nutritionist'].includes(currentUser.role) ? 'block' : 'none';
                }
                
                // 客户订餐: 与客户管理权限相同
                if (navItems['customer-orders']) {
                    navItems['customer-orders'].style.display = ['admin', 'nutritionist', 'admin_staff', 'head_nurse', 'nurse', 'caregiver'].includes(currentUser.role) ? 'block' : 'none';
                }
                
                // 成本计算、预算管理、财务报表: 与财务管理权限相同
                if (navItems['cost-calculation']) {
                    navItems['cost-calculation'].style.display = ['admin', 'admin_staff'].includes(currentUser.role) ? 'block' : 'none';
                }
                if (navItems['budget-management']) {
                    navItems['budget-management'].style.display = ['admin', 'admin_staff'].includes(currentUser.role) ? 'block' : 'none';
                }
                if (navItems['financial-reports']) {
                    navItems['financial-reports'].style.display = ['admin', 'admin_staff'].includes(currentUser.role) ? 'block' : 'none';
                }
                
                // 权限管理、考勤管理: 与员工管理权限相同
                if (navItems.permissions) {
                    navItems.permissions.style.display = ['admin', 'admin_staff'].includes(currentUser.role) ? 'block' : 'none';
                }
                if (navItems.attendance) {
                    navItems.attendance.style.display = ['admin', 'admin_staff'].includes(currentUser.role) ? 'block' : 'none';
                }
                
                // 系统配置、数据备份: 只有admin有权限
                if (navItems['system-config']) {
                    navItems['system-config'].style.display = currentUser.role === 'admin' ? 'block' : 'none';
                }
                if (navItems['data-backup']) {
                    navItems['data-backup'].style.display = currentUser.role === 'admin' ? 'block' : 'none';
                }
                
                // 帮助菜单的子菜单项对所有用户可见
                if (navItems['user-guide']) {
                    navItems['user-guide'].style.display = 'block';
                }
                if (navItems.faq) {
                    navItems.faq.style.display = 'block';
                }
                if (navItems['contact-us']) {
                    navItems['contact-us'].style.display = 'block';
                }
                if (navItems.about) {
                    navItems.about.style.display = 'block';
                }
                
                // 根据角色设置主题颜色
                switch(currentUser.role) {
                    case 'admin':
                    case 'nutritionist':
                        navbar.classList.add('theme-blue');
                        mainContent.classList.add('theme-blue');
                        if (currentUser.role === 'admin') {
                            document.getElementById('admin-content').style.display = 'block';
                        } else {
                            document.getElementById('admin-content').style.display = 'none';
                        }
                        break;
                    case 'chef':
                    case 'admin_staff':
                    case 'head_nurse':
                    case 'nurse':
                    case 'caregiver':
                        navbar.classList.add('theme-green');
                        mainContent.classList.add('theme-green');
                        document.getElementById('admin-content').style.display = 'none';
                        break;
                    case 'customer':
                    case 'guest':
                        navbar.classList.add('theme-pink');
                        mainContent.classList.add('theme-pink');
                        document.getElementById('admin-content').style.display = 'none';
                        break;
                    default:
                        navbar.classList.add('theme-green');
                        mainContent.classList.add('theme-green');
                        document.getElementById('admin-content').style.display = 'none';
                }
                
                showPage('home-page');
                loadDashboardData();
            } else {
                document.getElementById('guest-content').style.display = 'block';
                document.getElementById('user-content').style.display = 'none';
                document.getElementById('admin-content').style.display = 'none';
                
                // 对未登录用户隐藏敏感菜单项
                const navItems = {
                    'confinementDropdown': document.getElementById('confinementDropdown'),
                    'customers': document.querySelector('a[href="#customers"]'),
                    'financeDropdown': document.getElementById('financeDropdown'),
                    'employeeDropdown': document.getElementById('employeeDropdown'),
                    'systemDropdown': document.getElementById('systemDropdown'),
                    'helpDropdown': document.getElementById('helpDropdown')
                };
                
                // 隐藏敏感菜单项
                if (navItems.customers) {
                    navItems.customers.style.display = 'none';
                }
                if (navItems.financeDropdown) {
                    navItems.financeDropdown.style.display = 'none';
                }
                if (navItems.employeeDropdown) {
                    navItems.employeeDropdown.style.display = 'none';
                }
                if (navItems.systemDropdown) {
                    navItems.systemDropdown.style.display = 'none';
                }
                
                // 只显示每日餐单子菜单项
                if (navItems.confinementDropdown) {
                    const confinementMenu = navItems.confinementDropdown.nextElementSibling;
                    if (confinementMenu && confinementMenu.classList.contains('dropdown-menu')) {
                        const dropdownItems = confinementMenu.querySelectorAll('.dropdown-item');
                        dropdownItems.forEach(item => {
                            if (item.getAttribute('href') === '#daily-menus') {
                                item.style.display = 'block';
                            } else {
                                item.style.display = 'none';
                            }
                        });
                    }
                }
                
                // 帮助菜单对所有用户可见
                if (navItems.helpDropdown) {
                    navItems.helpDropdown.style.display = 'block';
                }
            }
        }

        // 退出登录
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            location.reload();
        }

        // 显示指定页面，隐藏其他页面
        function showPage(pageId) {
            // 隐藏所有用户页面
            document.querySelectorAll('#user-content > div').forEach(div => {
                div.style.display = 'none';
            });
            
            // 隐藏所有管理员页面
            document.querySelectorAll('#admin-content > div').forEach(div => {
                div.style.display = 'none';
            });
            
            // 显示目标页面
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.style.display = 'block';
            }
            
            // 更新导航栏激活状态
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + pageId) {
                    link.classList.add('active');
                }
            });
        }
        
        // 页面加载时初始化数据
        window.onload = function() {
            checkLoginStatus();
            loadDashboardData();
            loadMenus();
            loadDailyMenus();
            loadCustomers();
            loadDishes();
            loadIngredients();
            
            // 添加导航链接点击事件（只对导航栏中的链接）
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    if (href.startsWith('#')) {
                        e.preventDefault();
                        const targetId = href.substring(1);
                        showPage(targetId);
                    }
                });
            });
            
            // 添加下拉菜单点击事件
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    if (href.startsWith('#')) {
                        e.preventDefault();
                        const targetId = href.substring(1);
                        showPage(targetId);
                    }
                });
            });
            
            // 添加添加菜单按钮点击事件
            const addMenuBtn = document.getElementById('addMenuBtn');
            if (addMenuBtn) {
                const user = JSON.parse(localStorage.getItem('user'));
                if (user.role === 'nutritionist' || user.role === 'admin' || user.role === 'head_nurse') {
                    addMenuBtn.style.display = 'inline-block';
                }
                addMenuBtn.addEventListener('click', function() {
                    const addMenuModal = new bootstrap.Modal(document.getElementById('addMenuModal'));
                    addMenuModal.show();
                    loadAllDishesForModal();
                });
            }
            
            // 添加上传排餐表按钮点击事件
            const uploadScheduleBtn = document.getElementById('uploadScheduleBtn');
            if (uploadScheduleBtn) {
                uploadScheduleBtn.addEventListener('click', function() {
                    const uploadScheduleDiv = document.getElementById('upload-schedule');
                    uploadScheduleDiv.style.display = uploadScheduleDiv.style.display === 'none' ? 'block' : 'none';
                });
            }
            
            // 添加取消上传按钮点击事件
            const cancelUploadBtn = document.getElementById('cancelUploadBtn');
            if (cancelUploadBtn) {
                cancelUploadBtn.addEventListener('click', function() {
                    document.getElementById('upload-schedule').style.display = 'none';
                    document.getElementById('uploadForm').reset();
                });
            }
            
            // 添加保存菜单按钮点击事件
            const saveMenuButton = document.getElementById('saveMenuButton');
            if (saveMenuButton) {
                saveMenuButton.addEventListener('click', function() {
                    const name = document.getElementById('addMenuName').value;
                    const price = document.getElementById('addMenuPrice').value;
                    const features = document.getElementById('addMenuFeatures').value;
                    const nutrition = document.getElementById('addMenuNutrition').value;
                    const calories = document.getElementById('addMenuCalories').value;
                    const nutritionist = document.getElementById('addMenuNutritionist').value;
                    const createTime = document.getElementById('addMenuCreateTime').value;
                    
                    if (!name || !price || !nutritionist || !createTime) {
                        const messageDiv = document.getElementById('addMenuMessage');
                        messageDiv.className = 'alert alert-danger';
                        messageDiv.textContent = '请填写所有必填字段';
                        messageDiv.style.display = 'block';
                        return;
                    }
                    
                    const menuData = {
                        name: name,
                        price: parseFloat(price),
                        features: features,
                        nutrition: nutrition,
                        calories: parseInt(calories),
                        nutritionist: nutritionist,
                        create_time: createTime
                    };
                    
                    fetch('/api/menus', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(menuData)
                    })
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(data) {
                        const messageDiv = document.getElementById('addMenuMessage');
                        messageDiv.className = 'alert alert-success';
                        messageDiv.textContent = '菜单添加成功';
                        messageDiv.style.display = 'block';
                        
                        setTimeout(function() {
                            const addMenuModal = bootstrap.Modal.getInstance(document.getElementById('addMenuModal'));
                            addMenuModal.hide();
                            document.getElementById('addMenuForm').reset();
                            loadMenus();
                        }, 1500);
                    })
                    .catch(function(error) {
                        const messageDiv = document.getElementById('addMenuMessage');
                        messageDiv.className = 'alert alert-danger';
                        messageDiv.textContent = '菜单添加失败';
                        messageDiv.style.display = 'block';
                        console.error('Error adding menu:', error);
                    });
                });
            }
            
            // 添加删除菜单按钮点击事件
            const deleteMenuBtn = document.getElementById('deleteMenuBtn');
            if (deleteMenuBtn) {
                deleteMenuBtn.addEventListener('click', function() {
                    if (confirm('确定要删除该菜单吗？')) {
                        const activeMenuItem = document.querySelector('#menuList .active');
                        if (activeMenuItem) {
                            const menuId = activeMenuItem.dataset.menuId;
                            fetch(`/api/menus/${menuId}`, {
                                method: 'DELETE'
                            })
                            .then(function(response) {
                                if (response.ok) {
                                    loadMenus();
                                    document.getElementById('menuDetailPanel').style.display = 'none';
                                    document.getElementById('noMenuSelected').style.display = 'block';
                                }
                            })
                            .catch(function(error) {
                                console.error('Error deleting menu:', error);
                            });
                        }
                    }
                });
            }
            
            // 添加日期选择器事件监听器
            const dateFilter = document.getElementById('dateFilter');
            if (dateFilter) {
                dateFilter.addEventListener('change', function() {
                    const selectedDate = this.value;
                    if (selectedDate) {
                        loadDailyMenus(selectedDate);
                    }
                });
            }
            
            // 添加前一天按钮事件监听器
            const prevDayBtn = document.getElementById('prevDayBtn');
            if (prevDayBtn) {
                prevDayBtn.addEventListener('click', function() {
                    const currentDate = document.getElementById('dateFilter').value;
                    if (currentDate) {
                        const date = new Date(currentDate);
                        date.setDate(date.getDate() - 1);
                        const prevDate = date.toISOString().split('T')[0];
                        loadDailyMenus(prevDate);
                    }
                });
            }
            
            // 添加后一天按钮事件监听器
            const nextDayBtn = document.getElementById('nextDayBtn');
            if (nextDayBtn) {
                nextDayBtn.addEventListener('click', function() {
                    const currentDate = document.getElementById('dateFilter').value;
                    if (currentDate) {
                        const date = new Date(currentDate);
                        date.setDate(date.getDate() + 1);
                        const nextDate = date.toISOString().split('T')[0];
                        loadDailyMenus(nextDate);
                    }
                });
            }
            
            // 添加查询客户按钮事件监听器
            const searchCustomerBtn = document.getElementById('searchCustomerBtn');
            if (searchCustomerBtn) {
                searchCustomerBtn.addEventListener('click', function() {
                    searchCustomer();
                });
            }
            
            // 添加客户姓名输入框回车事件监听器
            const customerNameFilter = document.getElementById('customerNameFilter');
            if (customerNameFilter) {
                customerNameFilter.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchCustomer();
                    }
                });
            }
            
            // 添加添加员工按钮点击事件
            const addEmployeeBtn = document.getElementById('addEmployeeBtn');
            if (addEmployeeBtn) {
                addEmployeeBtn.addEventListener('click', function() {
                    const addEmployeeModal = new bootstrap.Modal(document.getElementById('addEmployeeModal'));
                    addEmployeeModal.show();
                });
            }
            
            // 添加保存员工按钮点击事件
            const saveEmployeeButton = document.getElementById('saveEmployeeButton');
            if (saveEmployeeButton) {
                saveEmployeeButton.addEventListener('click', function() {
                    const name = document.getElementById('employeeName').value;
                    const gender = document.getElementById('employeeGender').value;
                    const birthdate = document.getElementById('employeeBirthdate').value;
                    const ethnicity = document.getElementById('employeeEthnicity').value;
                    const department = document.getElementById('employeeDepartment').value;
                    const position = document.getElementById('employeePosition').value;
                    const idCard = document.getElementById('employeeIdCard').value;
                    const address = document.getElementById('employeeAddress').value;
                    const phone = document.getElementById('employeePhone').value;
                    const emergencyContact = document.getElementById('employeeEmergencyContact').value;
                    const emergencyPhone = document.getElementById('employeeEmergencyPhone').value;
                    const hometown = document.getElementById('employeeHometown').value;
                    const education = document.getElementById('employeeEducation').value;
                    const workExperience = document.getElementById('employeeWorkExperience').value;
                    const language = document.getElementById('employeeLanguage').value;
                    const certificates = document.getElementById('employeeCertificates').value;
                    const evaluation = document.getElementById('employeeEvaluation').value;
                    const family = document.getElementById('employeeFamily').value;
                    const messageDiv = document.getElementById('addEmployeeMessage');
                    
                    if (!name || !gender || !birthdate || !ethnicity || !department || !position || !idCard || !address || !phone || !emergencyContact || !emergencyPhone || !hometown) {
                        messageDiv.className = 'alert alert-danger';
                        messageDiv.textContent = '请填写所有必填字段';
                        messageDiv.style.display = 'block';
                        return;
                    }
                    
                    // 创建员工对象
                    const employee = {
                        name,
                        gender,
                        birthdate,
                        ethnicity,
                        department,
                        position,
                        idCard,
                        address,
                        phone,
                        emergencyContact,
                        emergencyPhone,
                        hometown,
                        education,
                        workExperience,
                        language,
                        certificates,
                        evaluation,
                        family
                    };
                    
                    // 保存员工信息到本地存储（模拟数据库存储）
                    let employees = JSON.parse(localStorage.getItem('employees')) || [];
                    employees.push(employee);
                    localStorage.setItem('employees', JSON.stringify(employees));
                    
                    // 显示保存成功消息
                    messageDiv.className = 'alert alert-success';
                    messageDiv.textContent = '员工添加成功';
                    messageDiv.style.display = 'block';
                    
                    // 3秒后关闭模态框并刷新页面
                    setTimeout(() => {
                        const addEmployeeModal = bootstrap.Modal.getInstance(document.getElementById('addEmployeeModal'));
                        addEmployeeModal.hide();
                        
                        // 清空表单
                        document.getElementById('addEmployeeForm').reset();
                        
                        // 刷新员工列表
                        loadEmployees();
                    }, 1500);
                });
            }
        };
        
        // 加载员工列表
        function loadEmployees() {
            // 从本地存储中读取员工信息
            let employees = JSON.parse(localStorage.getItem('employees')) || [];
            const employeesTableBody = document.getElementById('employeesTableBody');
            if (employeesTableBody) {
                if (employees.length === 0) {
                    employeesTableBody.innerHTML = `<tr><td colspan="5" class="text-center">暂无员工信息</td></tr>`;
                } else {
                    employeesTableBody.innerHTML = employees.map((employee, index) => `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${employee.name}</td>
                            <td>${employee.position}</td>
                            <td>${employee.phone}</td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="editEmployee(${index})">编辑</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${index})">删除</button>
                            </td>
                        </tr>
                    `).join('');
                }
            }
        }
        
        // 编辑员工
        function editEmployee(index) {
            // 从本地存储中读取员工信息
            let employees = JSON.parse(localStorage.getItem('employees')) || [];
            const employee = employees[index];
            
            // 填充表单数据
            document.getElementById('employeeName').value = employee.name;
            document.getElementById('employeeGender').value = employee.gender;
            document.getElementById('employeeBirthdate').value = employee.birthdate;
            document.getElementById('employeeEthnicity').value = employee.ethnicity;
            document.getElementById('employeeDepartment').value = employee.department;
            document.getElementById('employeePosition').value = employee.position;
            document.getElementById('employeeIdCard').value = employee.idCard;
            document.getElementById('employeeAddress').value = employee.address;
            document.getElementById('employeePhone').value = employee.phone;
            document.getElementById('employeeEmergencyContact').value = employee.emergencyContact;
            document.getElementById('employeeEmergencyPhone').value = employee.emergencyPhone;
            document.getElementById('employeeHometown').value = employee.hometown;
            document.getElementById('employeeEducation').value = employee.education;
            document.getElementById('employeeWorkExperience').value = employee.workExperience;
            document.getElementById('employeeLanguage').value = employee.language;
            document.getElementById('employeeCertificates').value = employee.certificates;
            document.getElementById('employeeEvaluation').value = employee.evaluation;
            document.getElementById('employeeFamily').value = employee.family;
            
            // 显示编辑模态框
            const addEmployeeModal = new bootstrap.Modal(document.getElementById('addEmployeeModal'));
            addEmployeeModal.show();
            
            // 修改模态框标题
            document.getElementById('addEmployeeModalLabel').textContent = '编辑员工';
            
            // 修改保存按钮的点击事件
            const saveEmployeeButton = document.getElementById('saveEmployeeButton');
            saveEmployeeButton.onclick = function() {
                // 获取表单数据
                const updatedEmployee = {
                    name: document.getElementById('employeeName').value,
                    gender: document.getElementById('employeeGender').value,
                    birthdate: document.getElementById('employeeBirthdate').value,
                    ethnicity: document.getElementById('employeeEthnicity').value,
                    department: document.getElementById('employeeDepartment').value,
                    position: document.getElementById('employeePosition').value,
                    idCard: document.getElementById('employeeIdCard').value,
                    address: document.getElementById('employeeAddress').value,
                    phone: document.getElementById('employeePhone').value,
                    emergencyContact: document.getElementById('employeeEmergencyContact').value,
                    emergencyPhone: document.getElementById('employeeEmergencyPhone').value,
                    hometown: document.getElementById('employeeHometown').value,
                    education: document.getElementById('employeeEducation').value,
                    workExperience: document.getElementById('employeeWorkExperience').value,
                    language: document.getElementById('employeeLanguage').value,
                    certificates: document.getElementById('employeeCertificates').value,
                    evaluation: document.getElementById('employeeEvaluation').value,
                    family: document.getElementById('employeeFamily').value
                };
                
                // 验证表单数据
                const messageDiv = document.getElementById('addEmployeeMessage');
                if (!updatedEmployee.name || !updatedEmployee.gender || !updatedEmployee.birthdate || !updatedEmployee.ethnicity || !updatedEmployee.department || !updatedEmployee.position || !updatedEmployee.idCard || !updatedEmployee.address || !updatedEmployee.phone || !updatedEmployee.emergencyContact || !updatedEmployee.emergencyPhone || !updatedEmployee.hometown) {
                    messageDiv.className = 'alert alert-danger';
                    messageDiv.textContent = '请填写所有必填字段';
                    messageDiv.style.display = 'block';
                    return;
                }
                
                // 更新员工信息
                employees[index] = updatedEmployee;
                localStorage.setItem('employees', JSON.stringify(employees));
                
                // 显示保存成功消息
                messageDiv.className = 'alert alert-success';
                messageDiv.textContent = '员工信息更新成功';
                messageDiv.style.display = 'block';
                
                // 3秒后关闭模态框并刷新页面
                setTimeout(() => {
                    const addEmployeeModal = bootstrap.Modal.getInstance(document.getElementById('addEmployeeModal'));
                    addEmployeeModal.hide();
                    
                    // 清空表单
                    document.getElementById('addEmployeeForm').reset();
                    
                    // 恢复模态框标题和保存按钮的点击事件
                    document.getElementById('addEmployeeModalLabel').textContent = '添加员工';
                    saveEmployeeButton.onclick = null;
                    
                    // 刷新员工列表
                    loadEmployees();
                }, 1500);
            };
        }
        
        // 删除员工
        function deleteEmployee(index) {
            if (confirm('确定要删除该员工信息吗？')) {
                // 从本地存储中读取员工信息
                let employees = JSON.parse(localStorage.getItem('employees')) || [];
                // 删除员工
                employees.splice(index, 1);
                // 保存到本地存储
                localStorage.setItem('employees', JSON.stringify(employees));
                // 刷新员工列表
                loadEmployees();
            }
        }
        
        // 员工查询
        function searchEmployee() {
            const name = document.getElementById('searchName').value;
            const idCard = document.getElementById('searchIdCard').value;
            
            if (!name || !idCard) {
                alert('请输入姓名和身份证号码');
                return;
            }
            
            // 从本地存储中读取员工信息
            let employees = JSON.parse(localStorage.getItem('employees')) || [];
            // 查找员工
            const foundEmployee = employees.find(employee => employee.name === name && employee.idCard === idCard);
            
            if (foundEmployee) {
                // 显示员工详情
                const employeesTableBody = document.getElementById('employeesTableBody');
                if (employeesTableBody) {
                    employeesTableBody.innerHTML = `
                        <tr>
                            <td>1</td>
                            <td>${foundEmployee.name}</td>
                            <td>${foundEmployee.position}</td>
                            <td>${foundEmployee.phone}</td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="editEmployee(${employees.indexOf(foundEmployee)})">编辑</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${employees.indexOf(foundEmployee)})">删除</button>
                            </td>
                        </tr>
                    `;
                }
            } else {
                alert('未找到该员工信息');
            }
        }
    </script>
</body>
</html>
