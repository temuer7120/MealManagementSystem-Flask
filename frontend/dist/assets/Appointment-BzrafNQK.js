import{d as e,o as a,c as l,k as t,l as i,r as n,E as s,n as o,h as d,a as r,F as p,C as u,b as m,q as c,A as _,J as v,B as f,p as y,t as g,_ as h}from"./index-D9a12nsq.js";import{a as w}from"./index-B1ATcuf8.js";const V={class:"appointment-container"},b={class:"card-header"},k={class:"service-categories"},x={class:"category-card"},C={class:"category-header"},U={class:"service-items"},q={class:"service-item-info"},z={class:"service-item-meta"},$={class:"duration"},A={class:"price"},B={class:"appointment-records",style:{"margin-top":"40px"}},I={class:"dialog-footer"},j=h(e({__name:"Appointment",setup(e){const h=n([]),j=n([]),D=n([]),S=n(!1),T=n(null),E=n({service_item_id:"",appointment_date:"",appointment_time:"",notes:""}),F=n({service_item_id:[{required:!0,message:"请选择服务项目",trigger:"change"}],appointment_date:[{required:!0,message:"请选择预约日期",trigger:"change"}],appointment_time:[{required:!0,message:"请选择预约时间",trigger:"change"}]}),J=v(()=>h.value.flatMap(e=>e.items||[])),M=async()=>{try{const e=await w.get("/api/appointments");j.value=e.data}catch(e){s.error("获取预约记录失败")}},O=()=>{E.value={service_item_id:"",appointment_date:"",appointment_time:"",notes:""},S.value=!0},R=async()=>{T.value&&await T.value.validate(async e=>{if(e)try{const e=new Date(`${E.value.appointment_date} ${E.value.appointment_time}`);await w.post("/api/appointments",{service_item_id:E.value.service_item_id,appointment_time:e.toISOString(),notes:E.value.notes});s.success("预约成功"),S.value=!1,M()}catch(a){s.error("预约失败")}})};return a(()=>{(async()=>{try{const e=(await w.get("/api/service_categories")).data;for(const a of e){const e=await w.get(`/api/service_items?category_id=${a.id}`);a.items=e.data}h.value=e}catch(e){s.error("获取服务分类失败")}})(),M()}),(e,a)=>{const n=o("el-icon"),v=o("el-button"),G=o("el-avatar"),H=o("el-list-item"),K=o("el-list"),L=o("el-collapse-item"),N=o("el-collapse"),P=o("el-card"),Q=o("el-col"),W=o("el-row"),X=o("el-table-column"),Y=o("el-table"),Z=o("el-option"),ee=o("el-select"),ae=o("el-form-item"),le=o("el-date-picker"),te=o("el-time-picker"),ie=o("el-input"),ne=o("el-form"),se=o("el-dialog");return d(),l("div",V,[t(P,{shadow:"hover"},{header:i(()=>[r("div",b,[a[8]||(a[8]=r("span",null,"服务预约",-1)),t(v,{type:"primary",onClick:O},{default:i(()=>[t(n,null,{default:i(()=>[t(c(_))]),_:1}),a[7]||(a[7]=m(" 新增预约 ",-1))]),_:1})])]),default:i(()=>[r("div",k,[a[10]||(a[10]=r("h3",null,"服务项目分类",-1)),t(W,{gutter:20},{default:i(()=>[(d(!0),l(p,null,u(h.value,e=>(d(),y(Q,{span:8,key:e.id},{default:i(()=>[t(P,{"body-style":{padding:"0px"}},{default:i(()=>[r("div",x,[r("div",C,[r("h4",null,g(e.name),1),r("p",null,g(e.description),1)]),r("div",U,[t(N,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e)},{default:i(()=>[t(L,{title:"查看服务项目",name:e.id},{default:i(()=>[t(K,null,{default:i(()=>[(d(!0),l(p,null,u(e.items,e=>(d(),y(H,{key:e.id},{prefix:i(()=>[t(G,{size:40,src:e.image_url||""},{default:i(()=>[m(g(e.name.charAt(0)),1)]),_:2},1032,["src"])]),suffix:i(()=>[t(v,{type:"primary",size:"small",onClick:a=>(e=>{E.value.service_item_id=e.id,S.value=!0})(e)},{default:i(()=>[...a[9]||(a[9]=[m(" 预约 ",-1)])]),_:1},8,["onClick"])]),default:i(()=>[r("div",q,[r("h5",null,g(e.name),1),r("p",null,g(e.description),1),r("div",z,[r("span",$,g(e.duration_minutes)+"分钟",1),r("span",A,"¥"+g(e.price),1)])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["name"])]),_:2},1032,["modelValue"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),r("div",B,[a[13]||(a[13]=r("h3",null,"预约记录",-1)),t(Y,{data:j.value,style:{width:"100%"}},{default:i(()=>[t(X,{prop:"id",label:"预约ID",width:"80"}),t(X,{prop:"service_item_name",label:"服务项目"}),t(X,{prop:"appointment_time",label:"预约时间"}),t(X,{prop:"status",label:"状态"}),t(X,{label:"操作",width:"150"},{default:i(e=>[t(v,{type:"primary",size:"small",onClick:a=>(e.row,void s.info("编辑预约功能开发中"))},{default:i(()=>[...a[11]||(a[11]=[m(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(v,{type:"danger",size:"small",onClick:a=>{return l=e.row.id,void f.confirm("确定要取消该预约吗？","取消预约",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await w.delete(`/api/appointments/${l}`),s.success("预约已取消"),M()}catch(e){s.error("取消预约失败")}});var l}},{default:i(()=>[...a[12]||(a[12]=[m(" 取消 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),t(se,{modelValue:S.value,"onUpdate:modelValue":a[6]||(a[6]=e=>S.value=e),title:"服务预约",width:"500px"},{footer:i(()=>[r("span",I,[t(v,{onClick:a[5]||(a[5]=e=>S.value=!1)},{default:i(()=>[...a[14]||(a[14]=[m("取消",-1)])]),_:1}),t(v,{type:"primary",onClick:R},{default:i(()=>[...a[15]||(a[15]=[m("确认预约",-1)])]),_:1})])]),default:i(()=>[t(ne,{model:E.value,rules:F.value,ref_key:"formRef",ref:T},{default:i(()=>[t(ae,{label:"服务项目",prop:"service_item_id"},{default:i(()=>[t(ee,{modelValue:E.value.service_item_id,"onUpdate:modelValue":a[1]||(a[1]=e=>E.value.service_item_id=e),placeholder:"选择服务项目"},{default:i(()=>[(d(!0),l(p,null,u(J.value,e=>(d(),y(Z,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(ae,{label:"预约日期",prop:"appointment_date"},{default:i(()=>[t(le,{modelValue:E.value.appointment_date,"onUpdate:modelValue":a[2]||(a[2]=e=>E.value.appointment_date=e),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(ae,{label:"预约时间",prop:"appointment_time"},{default:i(()=>[t(te,{modelValue:E.value.appointment_time,"onUpdate:modelValue":a[3]||(a[3]=e=>E.value.appointment_time=e),placeholder:"选择时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(ae,{label:"备注",prop:"notes"},{default:i(()=>[t(ie,{modelValue:E.value.notes,"onUpdate:modelValue":a[4]||(a[4]=e=>E.value.notes=e),type:"textarea",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-cb4a5c1d"]]);export{j as default};
