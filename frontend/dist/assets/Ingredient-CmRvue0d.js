import{d as e,o as a,c as l,a as t,b as i,H as n,I as r,f as s,w as u,r as o,g as c,h as d,i as p,v as f,j as v,Q as m,t as g,R as y,y as _,_ as b}from"./index-DZYZqGXU.js";import{a as h}from"./index-B1ATcuf8.js";const k={class:"ingredient-container"},w={class:"card"},V={class:"card-header"},U={class:"card-body"},x={class:"table table-striped"},C=["onClick"],K=["onClick"],T={class:"row"},I={class:"col-md-6"},J={class:"form-group"},N={class:"form-group"},q={class:"form-group"},B={class:"form-group"},D={class:"form-group"},E={class:"form-group"},O={class:"form-group"},P={class:"form-group"},S={class:"form-group"},j={class:"col-md-6"},M={class:"form-group mb-4"},$={key:0,class:"image-preview-container"},G={class:"image-preview"},z=["src"],F={class:"image-info"},H={key:1,class:"upload-prompt"},Q={key:2,class:"upload-progress"},R={class:"progress"},W=["aria-valuenow"],A={key:3,class:"upload-error"},L={class:"form-group"},X={class:"form-group"},Y={class:"form-group"},Z={class:"form-group"},ee={class:"form-group"},ae={class:"mt-4"},le={key:1,class:"alert alert-info"},te={key:2,class:"alert alert-success"},ie={class:"dialog-footer"},ne=b(e({__name:"Ingredient",setup(e){const b=o(!1),ne=o(!1),re=o([]),se=o(!1),ue=o(!1),oe=o(!1),ce=o(0),de=o(""),pe=o({id:null,name:"",category:"",stock:0,unit:"",unit_cost:null,description:"",calories_per_unit:null,nutrition_info:"",shelf_life_days:null,image_url:"",supplier:"",purchaser:"",purchase_date:"",features:"",taboo:""});a(()=>{fe()});const fe=async()=>{try{const e=await h.get("/api/ingredients");re.value=e.data}catch(e){}},ve=()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.capture="camera",e.onchange=e=>{e.target.files&&e.target.files[0]&&ge(e)},e.click()},me=()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{e.target.files&&e.target.files[0]&&ge(e)},e.click()},ge=async e=>{const a=e.target.files[0];await _e(a)},ye=async e=>{const a=e.dataTransfer.files[0];await _e(a)},_e=async e=>{if(e){if(!e.type.match("image.*"))return de.value="请上传有效的图片文件",void setTimeout(()=>{de.value=""},3e3);if(e.size>5242880)return de.value="图片大小不能超过5MB",void setTimeout(()=>{de.value=""},3e3);try{oe.value=!0,ce.value=0,de.value="";const a=new FormData;a.append("image",e);const l=await h.post("/api/upload/image",a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{e.total&&(ce.value=Math.round(100*e.loaded/e.total))}});a.value.image_url=l.data.image_url,setTimeout(()=>{oe.value=!1,ce.value=0},1e3)}catch(a){de.value="上传图片失败，请重试",oe.value=!1,ce.value=0,setTimeout(()=>{de.value=""},3e3)}}},be=()=>{pe.value.image_url="",de.value=""},he=()=>{if(!pe.value.image_url)return"";return`已上传: ${pe.value.image_url.split("/").pop()}`},ke=async()=>{if(pe.value.image_url){se.value=!0,ue.value=!1;try{const e=(await h.post("/api/ingredients/identify",{image_url:pe.value.image_url})).data;e.name&&(pe.value.name=e.name),e.category&&(pe.value.category=e.category),e.nutrition_info&&(pe.value.nutrition_info=JSON.stringify(e.nutrition_info)),e.calories&&(pe.value.calories_per_unit=e.calories),e.features&&(pe.value.features=e.features),e.taboo&&(pe.value.taboo=e.taboo),e.description&&(pe.value.description=e.description),e.shelf_life_days&&(pe.value.shelf_life_days=e.shelf_life_days),ue.value=!0,setTimeout(()=>{ue.value=!1},3e3)}catch(e){alert("自动识别失败，请重试")}finally{se.value=!1}}else alert("请先上传食材图片")},we=async()=>{try{const e={...pe.value,current_stock:pe.value.stock,unit_of_measure:pe.value.unit};if(e.nutrition_info)try{e.nutrition_info=JSON.parse(e.nutrition_info)}catch{}delete e.stock,delete e.unit,delete e.supplier,delete e.purchaser,delete e.purchase_date,delete e.features,delete e.taboo,ne.value?await h.put(`/api/ingredients/${e.id}`,e):await h.post("/api/ingredients",e),b.value=!1,fe(),Ve()}catch(e){alert("保存失败，请重试")}},Ve=()=>{pe.value={id:null,name:"",category:"",stock:0,unit:"",unit_cost:null,description:"",calories_per_unit:null,nutrition_info:"",shelf_life_days:null,image_url:"",supplier:"",purchaser:"",purchase_date:"",features:"",taboo:""},ne.value=!1,ue.value=!1},Ue=e=>{const a=document.getElementById(e);a&&a.focus()};return(e,a)=>{const o=c("el-button"),ge=c("el-dialog");return d(),l("div",k,[a[55]||(a[55]=t("h2",{class:"page-title"},[t("i",{class:"fas fa-seedling"}),i(" 食材管理 ")],-1)),t("div",w,[t("div",V,[t("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=e=>b.value=!0)},[...a[26]||(a[26]=[t("i",{class:"fas fa-plus"},null,-1),i(" 添加食材 ",-1)])])]),t("div",U,[t("table",x,[a[29]||(a[29]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"食材名称"),t("th",null,"食材类别"),t("th",null,"库存数量"),t("th",null,"单位"),t("th",null,"操作")])],-1)),t("tbody",null,[(d(!0),l(n,null,r(re.value,e=>(d(),l("tr",{key:e.id},[t("td",null,g(e.id),1),t("td",null,g(e.name),1),t("td",null,g(e.category),1),t("td",null,g(e.stock),1),t("td",null,g(e.unit),1),t("td",null,[t("button",{class:"btn btn-sm btn-info",onClick:a=>(e=>{ne.value=!0,pe.value={...e},b.value=!0})(e)},[...a[27]||(a[27]=[t("i",{class:"fas fa-edit"},null,-1),i(" 编辑 ",-1)])],8,C),t("button",{class:"btn btn-sm btn-danger",onClick:a=>(async e=>{try{await h.delete(`/api/ingredients/${e}`),fe()}catch(a){}})(e.id)},[...a[28]||(a[28]=[t("i",{class:"fas fa-trash"},null,-1),i(" 删除 ",-1)])],8,K)])]))),128))])])])]),s(ge,{modelValue:b.value,"onUpdate:modelValue":a[25]||(a[25]=e=>b.value=e),title:ne.value?"编辑食材":"添加食材",width:"800px"},{footer:u(()=>[t("span",ie,[s(o,{onClick:a[24]||(a[24]=e=>b.value=!1)},{default:u(()=>[...a[53]||(a[53]=[i("取消",-1)])]),_:1}),s(o,{type:"primary",onClick:we},{default:u(()=>[...a[54]||(a[54]=[i("保存",-1)])]),_:1})])]),default:u(()=>[t("div",T,[t("div",I,[t("div",J,[a[30]||(a[30]=t("label",{for:"ingredient-name"},"食材名称",-1)),p(t("input",{type:"text",class:"form-control",id:"ingredient-name","onUpdate:modelValue":a[1]||(a[1]=e=>pe.value.name=e),required:"",onKeyup:a[2]||(a[2]=v(e=>Ue("ingredient-category"),["enter"]))},null,544),[[f,pe.value.name]])]),t("div",N,[a[31]||(a[31]=t("label",{for:"ingredient-category"},"食材类别",-1)),p(t("input",{type:"text",class:"form-control",id:"ingredient-category","onUpdate:modelValue":a[3]||(a[3]=e=>pe.value.category=e),required:"",onKeyup:a[4]||(a[4]=v(e=>Ue("ingredient-stock"),["enter"]))},null,544),[[f,pe.value.category]])]),t("div",q,[a[32]||(a[32]=t("label",{for:"ingredient-stock"},"库存数量",-1)),p(t("input",{type:"number",class:"form-control",id:"ingredient-stock","onUpdate:modelValue":a[5]||(a[5]=e=>pe.value.stock=e),required:"",onKeyup:a[6]||(a[6]=v(e=>Ue("ingredient-unit"),["enter"]))},null,544),[[f,pe.value.stock]])]),t("div",B,[a[33]||(a[33]=t("label",{for:"ingredient-unit"},"单位",-1)),p(t("input",{type:"text",class:"form-control",id:"ingredient-unit","onUpdate:modelValue":a[7]||(a[7]=e=>pe.value.unit=e),required:"",onKeyup:a[8]||(a[8]=v(e=>Ue("ingredient-price"),["enter"]))},null,544),[[f,pe.value.unit]])]),t("div",D,[a[34]||(a[34]=t("label",{for:"ingredient-price"},"价格",-1)),p(t("input",{type:"number",class:"form-control",id:"ingredient-price","onUpdate:modelValue":a[9]||(a[9]=e=>pe.value.unit_cost=e),step:"0.01",onKeyup:a[10]||(a[10]=v(e=>Ue("ingredient-supplier"),["enter"]))},null,544),[[f,pe.value.unit_cost]])]),t("div",E,[a[35]||(a[35]=t("label",{for:"ingredient-supplier"},"供应商",-1)),p(t("input",{type:"text",class:"form-control",id:"ingredient-supplier","onUpdate:modelValue":a[11]||(a[11]=e=>pe.value.supplier=e),onKeyup:a[12]||(a[12]=v(e=>Ue("ingredient-purchaser"),["enter"]))},null,544),[[f,pe.value.supplier]])]),t("div",O,[a[36]||(a[36]=t("label",{for:"ingredient-purchaser"},"购买人",-1)),p(t("input",{type:"text",class:"form-control",id:"ingredient-purchaser","onUpdate:modelValue":a[13]||(a[13]=e=>pe.value.purchaser=e),onKeyup:a[14]||(a[14]=v(e=>Ue("ingredient-purchase-date"),["enter"]))},null,544),[[f,pe.value.purchaser]])]),t("div",P,[a[37]||(a[37]=t("label",{for:"ingredient-purchase-date"},"购入日期",-1)),p(t("input",{type:"date",class:"form-control",id:"ingredient-purchase-date","onUpdate:modelValue":a[15]||(a[15]=e=>pe.value.purchase_date=e),onKeyup:a[16]||(a[16]=v(e=>Ue("ingredient-shelf-life"),["enter"]))},null,544),[[f,pe.value.purchase_date]])]),t("div",S,[a[38]||(a[38]=t("label",{for:"ingredient-shelf-life"},"保质期（天）",-1)),p(t("input",{type:"number",class:"form-control",id:"ingredient-shelf-life","onUpdate:modelValue":a[17]||(a[17]=e=>pe.value.shelf_life_days=e),onKeyup:v(we,["enter"])},null,544),[[f,pe.value.shelf_life_days]])])]),t("div",j,[t("div",M,[a[44]||(a[44]=t("label",{class:"form-label"},"食材图片",-1)),t("div",{class:"image-upload-section",onDragover:a[18]||(a[18]=m(()=>{},["prevent"])),onDrop:m(ye,["prevent"])},[pe.value.image_url?(d(),l("div",$,[t("div",G,[t("img",{src:pe.value.image_url,alt:"食材图片",class:"preview-image"},null,8,z),t("button",{class:"btn-remove-image",onClick:be},[...a[39]||(a[39]=[t("i",{class:"fas fa-times"},null,-1)])])]),t("p",F,g(he()),1)])):(d(),l("div",H,[...a[40]||(a[40]=[t("div",{class:"upload-icon"},[t("i",{class:"fas fa-cloud-upload-alt"})],-1),t("h4",null,"上传食材图片",-1),t("p",{class:"upload-hint"},"点击上传或拖拽图片到此处",-1),t("p",{class:"upload-format"},"支持 JPG、PNG、WEBP 格式，最大 5MB",-1)])])),t("div",{class:"upload-buttons"},[t("button",{class:"btn btn-primary upload-btn mb-2",onClick:ve},[...a[41]||(a[41]=[t("i",{class:"fas fa-camera"},null,-1),i(" 拍照 ",-1)])]),t("button",{class:"btn btn-outline-primary upload-btn",onClick:me},[...a[42]||(a[42]=[t("i",{class:"fas fa-upload"},null,-1),i(" 选择图片 ",-1)])])]),oe.value?(d(),l("div",Q,[t("div",R,[t("div",{class:"progress-bar",role:"progressbar",style:y({width:ce.value+"%"}),"aria-valuenow":ce.value,"aria-valuemin":"0","aria-valuemax":"100"},g(ce.value)+"% ",13,W)])])):_("",!0),de.value?(d(),l("div",A,[a[43]||(a[43]=t("i",{class:"fas fa-exclamation-circle"},null,-1)),t("span",null,g(de.value),1)])):_("",!0)],32)]),t("div",L,[a[45]||(a[45]=t("label",{for:"ingredient-nutrition"},"营养成分",-1)),p(t("textarea",{class:"form-control",id:"ingredient-nutrition","onUpdate:modelValue":a[19]||(a[19]=e=>pe.value.nutrition_info=e),rows:"3",placeholder:'JSON格式，如：{"蛋白质": "10g", "碳水化合物": "20g", "脂肪": "5g"}'},null,512),[[f,pe.value.nutrition_info]])]),t("div",X,[a[46]||(a[46]=t("label",{for:"ingredient-calories"},"热量值（每单位）",-1)),p(t("input",{type:"number",class:"form-control",id:"ingredient-calories","onUpdate:modelValue":a[20]||(a[20]=e=>pe.value.calories_per_unit=e),step:"0.01"},null,512),[[f,pe.value.calories_per_unit]])]),t("div",Y,[a[47]||(a[47]=t("label",{for:"ingredient-nutrition"},"营养成分",-1)),p(t("textarea",{class:"form-control",id:"ingredient-nutrition","onUpdate:modelValue":a[21]||(a[21]=e=>pe.value.nutrition_info=e),rows:"3",placeholder:'JSON格式，如：{"蛋白质": "10g", "碳水化合物": "20g", "脂肪": "5g"}'},null,512),[[f,pe.value.nutrition_info]])]),t("div",Z,[a[48]||(a[48]=t("label",{for:"ingredient-features"},"特点",-1)),p(t("textarea",{class:"form-control",id:"ingredient-features","onUpdate:modelValue":a[22]||(a[22]=e=>pe.value.features=e),rows:"2"},null,512),[[f,pe.value.features]])]),t("div",ee,[a[49]||(a[49]=t("label",{for:"ingredient-taboo"},"禁忌",-1)),p(t("textarea",{class:"form-control",id:"ingredient-taboo","onUpdate:modelValue":a[23]||(a[23]=e=>pe.value.taboo=e),rows:"2"},null,512),[[f,pe.value.taboo]])])])]),t("div",ae,[pe.value.image_url?(d(),l("button",{key:0,class:"btn btn-info mb-3",onClick:ke},[...a[50]||(a[50]=[t("i",{class:"fas fa-magic"},null,-1),i(" 自动识别食材 ",-1)])])):_("",!0),se.value?(d(),l("div",le,[...a[51]||(a[51]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1),i(" 正在识别食材，请稍候... ",-1)])])):_("",!0),ue.value?(d(),l("div",te,[...a[52]||(a[52]=[t("i",{class:"fas fa-check"},null,-1),i(" 食材识别成功！已自动填充相关信息。 ",-1)])])):_("",!0)])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-217d83c2"]]);export{ne as default};
