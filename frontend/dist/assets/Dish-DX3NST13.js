import{d as e,o as a,c as l,a as t,f as i,w as s,r as n,E as o,g as r,h as u,b as d,t as c,s as p,F as m,G as v,C as g,j as f,H as _,I as h,q as y,y as w,J as b,K as V,L as x,M as k,N as C,O as q,P as z,D,_ as F}from"./index-DZYZqGXU.js";import{a as U}from"./index-B1ATcuf8.js";const T={class:"dish-container"},$={class:"card-header"},E={class:"form-row"},I={class:"form-row"},J={class:"image-upload-section"},M={key:0,class:"image-preview"},N=["src"],S={key:1,class:"upload-area"},O={class:"upload-content"},B={class:"upload-buttons"},G={class:"card-header"},P={class:"ingredient-combination"},j={class:"ingredient-library"},L={class:"library-header"},K={class:"ingredient-items"},W=["onDragstart"],A={class:"ingredient-info"},H={class:"ingredient-name"},R={class:"ingredient-price"},Q={key:0,class:"empty-ingredients"},X={class:"dish-ingredients-container"},Y={class:"container-header"},Z={key:0,class:"nutrition-summary"},ee={key:0,class:"dish-ingredients"},ae={class:"ingredient-details"},le={class:"ingredient-name"},te={class:"quantity-control"},ie={class:"ingredient-unit"},se={key:1,class:"empty-drop-zone"},ne={class:"search-section"},oe={key:0,class:"loading-section"},re={class:"dialog-footer"},ue={class:"tip-content"},de={class:"dialog-footer"},ce=F(e({__name:"Dish",setup(e){const F=n([]),ce=n([]),pe=n([]),me=n(!1),ve=n(!1),ge=n(null),fe=n(!1),_e=n(0),he=n(""),ye=n(!1),we=n(!1),be=n(""),Ve=n(""),xe=n(null),ke=n(null),Ce=n({id:"",name:"",nutrition_info:"",price:0,total_weight:0,category_id:"",is_active:!0,image_url:"",ingredients:[]}),qe=n({name:[{required:!0,message:"请输入菜品名称",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],category_id:[{required:!0,message:"请选择分类",trigger:"change"}]}),ze=z(()=>Ve.value?pe.value.filter(e=>e.name.toLowerCase().includes(Ve.value.toLowerCase())):pe.value),De=e=>{const a=ce.value.find(a=>a.id===e);return a?a.name:"未知分类"},Fe=()=>{Ce.value={id:"",name:"",nutrition_info:"",price:0,total_weight:0,category_id:"",is_active:!0,image_url:"",ingredients:[]},ke.value=null,me.value=!0},Ue=()=>{ve.value=!0},Te=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},$e=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},Ee=e=>{if(e.preventDefault(),xe.value){if(-1===Ce.value.ingredients.findIndex(e=>e.id===xe.value.id)){const e={...xe.value,quantity:1};Ce.value.ingredients.push(e),Ie(),o.success(`已添加食材: ${xe.value.name}`)}else o.warning("该食材已存在于菜品中")}},Ie=()=>{let e=0,a=0,l=0,t=0,i=0;Ce.value.ingredients.forEach(s=>{try{const t=JSON.parse(s.nutrition_info);t.蛋白质&&(e+=parseFloat(t.蛋白质)*s.quantity),t.碳水化合物&&(a+=parseFloat(t.碳水化合物)*s.quantity),t.脂肪&&(l+=parseFloat(t.脂肪)*s.quantity)}catch(n){}t+=s.quantity,i+=s.unit_cost*s.quantity}),Ce.value.nutrition_info=JSON.stringify({"蛋白质":`${e.toFixed(1)}g`,"碳水化合物":`${a.toFixed(1)}g`,"脂肪":`${l.toFixed(1)}g`}),Ce.value.total_weight=t,Ce.value.price=1.5*i},Je=()=>{try{if(!Ce.value.nutrition_info)return"无";const e=JSON.parse(Ce.value.nutrition_info);return`蛋白质: ${e.蛋白质}, 碳水: ${e.碳水化合物}, 脂肪: ${e.脂肪}`}catch(e){return"无"}},Me=()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.capture="camera",e.onchange=e=>{e.target.files&&e.target.files[0]&&Ne(e)},e.click()},Ne=async e=>{const a=e.target.files[0];if(a)try{fe.value=!0,_e.value=0,he.value="";const e=new FormData;e.append("image",a);const l=await U.post("/api/upload/image",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{e.total&&(_e.value=Math.round(100*e.loaded/e.total))}});Ce.value.image_url=l.data.image_url,setTimeout(()=>{fe.value=!1,_e.value=0},1e3),o.success("图片上传成功")}catch(l){he.value="上传图片失败，请重试",fe.value=!1,_e.value=0,setTimeout(()=>{he.value=""},3e3),o.error("上传图片失败，请重试")}},Se=e=>{Ce.value.image_url=e.image_url,o.success("图片上传成功")},Oe=()=>{o.error("上传图片失败，请重试")},Be=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<2;return a?!!l||(o.error("图片大小不能超过 2MB！"),!1):(o.error("只能上传图片文件！"),!1)},Ge=()=>{Ce.value.image_url="",he.value="",o.success("图片已删除")},Pe=async()=>{if(be.value){ye.value=!0,ke.value=null;try{setTimeout(()=>{const e={name:be.value,ingredients:[{id:1,name:"西红柿",unit_cost:2.5,unit_of_measure:"个",quantity:2,nutrition_info:'{"蛋白质": "0.9g", "碳水化合物": "4g", "脂肪": "0.2g"}'},{id:2,name:"鸡蛋",unit_cost:1.2,unit_of_measure:"个",quantity:3,nutrition_info:'{"蛋白质": "6.3g", "碳水化合物": "0.6g", "脂肪": "5.3g"}'}],nutrition_info:'{"蛋白质": "20g", "碳水化合物": "10g", "脂肪": "15g"}',total_weight:300,price:15};Ce.value.name=e.name,Ce.value.ingredients=e.ingredients,Ce.value.nutrition_info=e.nutrition_info,Ce.value.total_weight=e.total_weight,Ce.value.price=e.price,ke.value=e,o.success("查询分解成功，已自动填充菜品信息"),ye.value=!1},1500)}catch(e){o.error("查询分解失败，请重试"),ye.value=!1}}else o.warning("请输入菜品名称")},je=async()=>{ge.value&&(we.value=!0,await ge.value.validate(async e=>{if(e)try{if(Ce.value.id){const e=F.value.findIndex(e=>e.id===Ce.value.id);-1!==e&&(F.value[e]={...Ce.value}),o.success("菜品更新成功")}else{const e={...Ce.value,id:F.value.length+1};F.value.push(e),o.success("菜品创建成功")}me.value=!1}catch(a){o.error("保存菜品失败")}finally{we.value=!1}else we.value=!1}))};return a(()=>{(async()=>{try{F.value=[{id:1,name:"清蒸鱼",nutrition_info:'{"蛋白质": "25g", "碳水化合物": "5g", "脂肪": "15g"}',price:88,total_weight:500,category_id:1,is_active:!0},{id:2,name:"红烧肉",nutrition_info:'{"蛋白质": "20g", "碳水化合物": "10g", "脂肪": "30g"}',price:68,total_weight:400,category_id:1,is_active:!0},{id:3,name:"蔬菜沙拉",nutrition_info:'{"蛋白质": "5g", "碳水化合物": "20g", "脂肪": "10g"}',price:38,total_weight:300,category_id:2,is_active:!0}]}catch(e){o.error("获取菜品列表失败")}})(),(async()=>{try{ce.value=[{id:1,name:"主菜"},{id:2,name:"配菜"},{id:3,name:"汤品"},{id:4,name:"点心"}]}catch(e){o.error("获取分类列表失败")}})(),(async()=>{try{pe.value=[{id:1,name:"西红柿",unit_cost:2.5,unit_of_measure:"个",nutrition_info:'{"蛋白质": "0.9g", "碳水化合物": "4g", "脂肪": "0.2g"}'},{id:2,name:"鸡蛋",unit_cost:1.2,unit_of_measure:"个",nutrition_info:'{"蛋白质": "6.3g", "碳水化合物": "0.6g", "脂肪": "5.3g"}'},{id:3,name:"大米",unit_cost:6.5,unit_of_measure:"kg",nutrition_info:'{"蛋白质": "7.5g", "碳水化合物": "77g", "脂肪": "0.9g"}'},{id:4,name:"青菜",unit_cost:3.8,unit_of_measure:"斤",nutrition_info:'{"蛋白质": "2.6g", "碳水化合物": "2.8g", "脂肪": "0.3g"}'},{id:5,name:"猪肉",unit_cost:28.5,unit_of_measure:"斤",nutrition_info:'{"蛋白质": "20.3g", "碳水化合物": "1.1g", "脂肪": "10.8g"}'}]}catch(e){o.error("获取食材列表失败")}})()}),(e,a)=>{const n=r("el-icon"),z=r("el-button"),U=r("el-table-column"),pe=r("el-tag"),fe=r("el-table"),_e=r("el-card"),he=r("el-input"),Ne=r("el-form-item"),Le=r("el-option"),Ke=r("el-select"),We=r("el-input-number"),Ae=r("el-switch"),He=r("el-alert"),Re=r("el-upload"),Qe=r("Warning"),Xe=r("el-form"),Ye=r("el-dialog");return u(),l("div",T,[a[39]||(a[39]=t("h2",{class:"page-title"},"菜品管理",-1)),i(_e,{shadow:"hover",class:"dish-card"},{header:s(()=>[t("div",$,[a[16]||(a[16]=t("span",{class:"card-title"},"菜品列表",-1)),i(z,{type:"primary",onClick:Fe,class:"add-btn"},{default:s(()=>[i(n,null,{default:s(()=>[i(p(g))]),_:1}),a[15]||(a[15]=d(" 新增菜品 ",-1))]),_:1})])]),default:s(()=>[i(fe,{data:F.value,style:{width:"100%"},stripe:"","highlight-current-row":""},{default:s(()=>[i(U,{prop:"id",label:"ID",width:"80"}),i(U,{prop:"name",label:"菜品名称","min-width":"120"}),i(U,{prop:"nutrition_info",label:"营养成分","min-width":"180"}),i(U,{prop:"price",label:"价格",width:"100"}),i(U,{prop:"total_weight",label:"总量",width:"100"}),i(U,{prop:"category_id",label:"分类",width:"120"},{default:s(e=>[i(pe,{size:"small",effect:"light"},{default:s(()=>[d(c(De(e.row.category_id)),1)]),_:2},1024)]),_:1}),i(U,{prop:"is_active",label:"状态",width:"100"},{default:s(e=>[i(pe,{type:e.row.is_active?"success":"danger",size:"small"},{default:s(()=>[d(c(e.row.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),i(U,{label:"操作",width:"180",fixed:"right"},{default:s(e=>[i(z,{type:"primary",size:"small",onClick:a=>{return l=e.row,Ce.value={...l},Ce.value.ingredients||(Ce.value.ingredients=[]),ke.value=null,void(me.value=!0);var l},class:"edit-btn"},{default:s(()=>[i(n,null,{default:s(()=>[i(p(m))]),_:1}),a[17]||(a[17]=d(" 编辑 ",-1))]),_:1},8,["onClick"]),i(z,{type:"danger",size:"small",onClick:a=>{return l=e.row.id,void D.confirm("确定要删除该菜品吗？","删除菜品",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{F.value=F.value.filter(e=>e.id!==l),o.success("菜品删除成功")}catch(e){o.error("删除菜品失败")}});var l},class:"delete-btn"},{default:s(()=>[i(n,null,{default:s(()=>[i(p(v))]),_:1}),a[18]||(a[18]=d(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),i(Ye,{modelValue:me.value,"onUpdate:modelValue":a[12]||(a[12]=e=>me.value=e),title:Ce.value.id?"编辑菜品":"新增菜品",width:"900px","close-on-click-modal":!1,"custom-class":"dish-dialog"},{footer:s(()=>[t("span",re,[i(z,{onClick:a[11]||(a[11]=e=>me.value=!1),class:"cancel-btn"},{default:s(()=>[...a[36]||(a[36]=[d("取消",-1)])]),_:1}),i(z,{type:"primary",onClick:je,loading:we.value,class:"save-btn"},{default:s(()=>[...a[37]||(a[37]=[d("保存",-1)])]),_:1},8,["loading"])])]),default:s(()=>[i(Xe,{model:Ce.value,rules:qe.value,ref_key:"formRef",ref:ge,"label-width":"100px",class:"dish-form"},{default:s(()=>[i(_e,{class:"form-card",shadow:"hover"},{header:s(()=>[...a[19]||(a[19]=[t("div",{class:"card-header"},[t("span",{class:"card-title"},"基本信息")],-1)])]),default:s(()=>[t("div",E,[i(Ne,{label:"菜品名称",prop:"name",class:"form-item"},{default:s(()=>[i(he,{modelValue:Ce.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>Ce.value.name=e),placeholder:"请输入菜品名称",onKeyup:a[1]||(a[1]=f(e=>{},["enter"])),class:"form-input"},null,8,["modelValue"])]),_:1}),i(Ne,{label:"分类",prop:"category_id",class:"form-item"},{default:s(()=>[i(Ke,{modelValue:Ce.value.category_id,"onUpdate:modelValue":a[2]||(a[2]=e=>Ce.value.category_id=e),placeholder:"请选择分类",class:"form-select"},{default:s(()=>[(u(!0),l(_,null,h(ce.value,e=>(u(),y(Le,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),t("div",I,[i(Ne,{label:"价格",prop:"price",class:"form-item"},{default:s(()=>[i(We,{modelValue:Ce.value.price,"onUpdate:modelValue":a[3]||(a[3]=e=>Ce.value.price=e),min:0,step:.01,placeholder:"请输入价格",class:"form-input"},null,8,["modelValue"])]),_:1}),i(Ne,{label:"总量",prop:"total_weight",class:"form-item"},{default:s(()=>[i(We,{modelValue:Ce.value.total_weight,"onUpdate:modelValue":a[4]||(a[4]=e=>Ce.value.total_weight=e),min:0,step:.01,placeholder:"请输入总量",class:"form-input"},null,8,["modelValue"])]),_:1}),i(Ne,{label:"状态",class:"form-item"},{default:s(()=>[i(Ae,{modelValue:Ce.value.is_active,"onUpdate:modelValue":a[5]||(a[5]=e=>Ce.value.is_active=e),"active-color":"#409EFF","inactive-color":"#DCDFE6"},null,8,["modelValue"])]),_:1})]),i(Ne,{label:"营养成分",prop:"nutrition_info",class:"form-item"},{default:s(()=>[i(he,{modelValue:Ce.value.nutrition_info,"onUpdate:modelValue":a[6]||(a[6]=e=>Ce.value.nutrition_info=e),type:"textarea",rows:3,placeholder:'JSON格式，如：{"蛋白质": "20g", "碳水化合物": "30g", "脂肪": "10g"}',class:"form-textarea"},null,8,["modelValue"]),Ce.value.nutrition_info?w("",!0):(u(),y(He,{key:0,title:"提示",type:"info",closable:!1,"show-icon":"",class:"nutrition-tip"},{default:s(()=>[...a[20]||(a[20]=[d(" 营养成分会根据食材自动计算，也可以手动填写 ",-1)])]),_:1}))]),_:1})]),_:1}),i(_e,{class:"form-card",shadow:"hover",style:{"margin-top":"20px"}},{header:s(()=>[...a[21]||(a[21]=[t("div",{class:"card-header"},[t("span",{class:"card-title"},"菜品图片")],-1)])]),default:s(()=>[t("div",J,[Ce.value.image_url?(u(),l("div",M,[t("img",{src:Ce.value.image_url,alt:"菜品图片",class:"preview-image"},null,8,N),i(z,{type:"danger",size:"small",onClick:Ge,class:"remove-image-btn"},{default:s(()=>[i(n,null,{default:s(()=>[i(p(v))]),_:1}),a[22]||(a[22]=d(" 删除图片 ",-1))]),_:1})])):(u(),l("div",S,[i(Re,{class:"image-upload",action:"/api/upload/image","on-success":Se,"on-error":Oe,"before-upload":Be,"show-file-list":!1,accept:"image/*"},{default:s(()=>[t("div",O,[i(n,{class:"upload-icon"},{default:s(()=>[i(p(b))]),_:1}),a[23]||(a[23]=t("div",{class:"upload-text"},"点击或拖拽上传图片",-1)),a[24]||(a[24]=t("div",{class:"upload-hint"},"支持 JPG、PNG、GIF 格式，大小不超过 2MB",-1))])]),_:1}),t("div",B,[i(z,{type:"primary",onClick:Me,class:"photo-btn"},{default:s(()=>[i(n,null,{default:s(()=>[i(p(V))]),_:1}),a[25]||(a[25]=d(" 拍照上传 ",-1))]),_:1})])]))])]),_:1}),i(_e,{class:"form-card",shadow:"hover",style:{"margin-top":"20px"}},{header:s(()=>[t("div",G,[a[27]||(a[27]=t("span",{class:"card-title"},"食材组合",-1)),i(z,{type:"info",size:"small",onClick:Ue,class:"tip-btn"},{default:s(()=>[i(n,null,{default:s(()=>[i(p(C))]),_:1}),a[26]||(a[26]=d(" 使用提示 ",-1))]),_:1})])]),default:s(()=>[t("div",P,[t("div",j,[t("div",L,[a[28]||(a[28]=t("h4",{class:"library-title"},"食材库",-1)),i(he,{modelValue:Ve.value,"onUpdate:modelValue":a[7]||(a[7]=e=>Ve.value=e),placeholder:"搜索食材",class:"ingredient-search"},{prefix:s(()=>[i(n,null,{default:s(()=>[i(p(x))]),_:1})]),_:1},8,["modelValue"])]),t("div",K,[(u(!0),l(_,null,h(ze.value,e=>(u(),l("div",{key:e.id,class:"ingredient-item",draggable:"true",onDragstart:a=>((e,a)=>{xe.value=a,e.dataTransfer.effectAllowed="copy"})(a,e),onMouseenter:a[8]||(a[8]=e=>e.target.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"),onMouseleave:a[9]||(a[9]=e=>e.target.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)")},[t("div",A,[t("span",H,c(e.name),1),t("span",R,c(e.unit_cost)+"元/"+c(e.unit_of_measure),1)])],40,W))),128)),0===ze.value.length?(u(),l("div",Q,[i(n,null,{default:s(()=>[i(Qe)]),_:1}),a[29]||(a[29]=t("p",null,"未找到匹配的食材",-1))])):w("",!0)])]),t("div",X,[t("div",Y,[a[30]||(a[30]=t("h4",{class:"container-title"},"菜品食材",-1)),Ce.value.ingredients&&Ce.value.ingredients.length>0?(u(),l("div",Z,[i(pe,{size:"small",class:"nutrition-tag"},{default:s(()=>[d(" 营养: "+c(Je()),1)]),_:1}),i(pe,{size:"small",class:"price-tag"},{default:s(()=>[d(" 价格: "+c(Ce.value.price.toFixed(2))+"元 ",1)]),_:1}),i(pe,{size:"small",class:"weight-tag"},{default:s(()=>[d(" 总量: "+c(Ce.value.total_weight.toFixed(2)),1)]),_:1})])):w("",!0)]),t("div",{class:"drop-zone",onDragover:$e,onDrop:Ee,onDragenter:Te},[Ce.value.ingredients&&Ce.value.ingredients.length>0?(u(),l("div",ee,[(u(!0),l(_,null,h(Ce.value.ingredients,(e,a)=>(u(),l("div",{key:a,class:"dish-ingredient-item"},[t("div",ae,[t("span",le,c(e.name),1),t("div",te,[i(We,{modelValue:e.quantity,"onUpdate:modelValue":a=>e.quantity=a,min:.01,step:.01,placeholder:"用量",size:"small",onChange:Ie,class:"quantity-input"},null,8,["modelValue","onUpdate:modelValue"]),t("span",ie,c(e.unit_of_measure),1)])]),i(z,{type:"danger",size:"small",onClick:e=>(e=>{const a=Ce.value.ingredients[e];Ce.value.ingredients.splice(e,1),Ie(),o.success(`已移除食材: ${a.name}`)})(a),class:"remove-ingredient-btn"},{default:s(()=>[i(n,null,{default:s(()=>[i(p(v))]),_:1})]),_:1},8,["onClick"])]))),128))])):(u(),l("div",se,[i(n,{class:"drop-icon"},{default:s(()=>[i(p(k))]),_:1}),a[31]||(a[31]=t("p",{class:"drop-text"},"从左侧拖拽食材到此处",-1)),a[32]||(a[32]=t("p",{class:"drop-hint"},"或点击食材添加到菜品中",-1))]))],32)])])]),_:1}),i(_e,{class:"form-card",shadow:"hover",style:{"margin-top":"20px"}},{header:s(()=>[...a[33]||(a[33]=[t("div",{class:"card-header"},[t("span",{class:"card-title"},"网络查询分解")],-1)])]),default:s(()=>[t("div",ne,[i(Ne,{class:"search-form-item"},{default:s(()=>[i(he,{modelValue:be.value,"onUpdate:modelValue":a[10]||(a[10]=e=>be.value=e),placeholder:"请输入菜品名称进行网络查询",class:"search-input","prefix-icon":p(x)},null,8,["modelValue","prefix-icon"]),i(z,{type:"primary",onClick:Pe,loading:ye.value,class:"search-btn"},{default:s(()=>[...a[34]||(a[34]=[d(" 查询并分解 ",-1)])]),_:1},8,["loading"])]),_:1}),ye.value?(u(),l("div",oe,[i(n,{class:"loading-icon"},{default:s(()=>[i(p(q))]),_:1}),a[35]||(a[35]=t("span",{class:"loading-text"},"正在查询... 请稍候",-1))])):w("",!0),ke.value?(u(),y(He,{key:1,title:ke.value.name,type:"success",description:"查询成功，已自动填充菜品信息","show-icon":"",class:"search-result-alert"},null,8,["title"])):w("",!0)])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),i(Ye,{modelValue:ve.value,"onUpdate:modelValue":a[14]||(a[14]=e=>ve.value=e),title:"食材组合使用提示",width:"500px"},{footer:s(()=>[t("span",de,[i(z,{onClick:a[13]||(a[13]=e=>ve.value=!1)},{default:s(()=>[...a[38]||(a[38]=[d("我知道了",-1)])]),_:1})])]),default:s(()=>[t("div",ue,[i(He,{title:"拖拽操作",type:"info",description:"从左侧食材库中拖拽食材到右侧菜品食材区域","show-icon":"",class:"tip-alert"}),i(He,{title:"用量调整",type:"info",description:"拖拽后可以调整每个食材的用量，系统会自动重新计算营养成分、总量和价格","show-icon":"",class:"tip-alert"}),i(He,{title:"网络查询",type:"info",description:"可以通过输入菜品名称进行网络查询，系统会自动分解成食材组合并填充信息","show-icon":"",class:"tip-alert"})])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-6973d0ee"]]);export{ce as default};
